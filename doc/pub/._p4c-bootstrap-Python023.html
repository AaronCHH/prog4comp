<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Programming for Computations - A Gentle Introduction to Numerical Simulations with Python">
<meta name="keywords" content="DocOnce,computer program,programming,language programming,language computer,MATLAB,Octave,Fortran,C,C++,Python,Maple,Mathematica,syntax,bug,debugging,script (and scripting),algorithm,execute (a program),implement (a program),bug,debugging,simulation,model mathematical,print,program run,program execute,code,comment,instruction,program statement,variable,assignment,calculator,text editor,Emacs,Vim,Gedit,Notepad++,TextWrangler,Spyder,Python  installation,IPython,prompt,program typing,program run,program execute,function,function call,atan,function input parameter,function output parameter,function return,function take a parameter,library,library function,from,module,package,NameError,WARNING,import  math,math,plot,numpy,import numpy,matplotlib.pyplot,import matplotlib.pyplot,linspace,xlabel,ylabel,plot,array,interactive use (of Python),keyboard arrow up/down,prompt,Python shell,IPython,import,operator Arithmetic,parentheses,rounding error,variable type,variable name,object,float,int,str,type conversion,reserved words,variable int,variable float,variable str,variable assignment,type conversion automatic,integer division,rounding error,printing formatted,printf formatting,default,array,array element,zeros,allocate,array index,indexing zero based,indexing one based,Python zero-based indexing,array slice of,copy,graph,hold (on/off),plot figure,title (plot),legend (plot),axis (plot),hardcopy (plot),format png,matrix mat,transpose (of matrix),matrix vector product,linear algebra,matrix,vector,error message,debugging,debugger,try-exception,exception handling,program crash,program testing,testing,program verification,verification,validation,list,tuple,raw input,program input,program output,input,symbolic computations,symbolic operations,symbolic simplifications,SymPy,library SymPy,WolframAlpha,Mathematica,Sage (symbolic package),variable delete,Python documentation,garbage collection,long lines (splitting of),fast code,commenting code,if,elif,else,colon,indent,boolean,boolean expression,True,False,boolean True,boolean False,pseudo code,random walk,random (function),import random (function),operator Logical,def,function,function definition,return,argument,parameter input,parameter output,main program,return value,variable local,variable global,argument keyword,argument named,argument ordinary,argument positional,doc string,function handle,function local,function global,function nested,lambda function,range,loop for,for loop,loop iteration,loop index,loop double,loop multiple,loop nested,linear algebra,while loop,loop while,loop infinite,loop iteration,loop index,stop program (Ctrl+c),list,list append,list convert to array,list delete,list create,tuple,list comprehension,read (from file),write (to file),loadtxt,savetxt,array sorting,Leibniz pi,Euler pi,programming game,linear interpolation,least squares method,Fourier series,integral analytically,integral exact,integral numerically,integral approximately,Trapezoidal rule,composite trapezoidal rule,integration points,implementation specific,implementation general,import module,module,test block,code re-use,flat program,program flat,error function (erf),Midpoint method,composite midpoint method,Simpson's rule,Gauss quadrature,bug,unit tests,testing procedures,convergence rate,rate of convergence,error asymptotic,finite precision (of float),floating point number (float),error rounding,error tolerance,difference absolute,difference relative,assert (function),function assert,nose (testing),py.test,test function,vectorization,computational speed (measuring),domain,double integral midpoint,double sum,code re-use,triple integral midpoint,domain,domain complex,domain,Monte Carlo integration,seed (random generators),dynamical system,scheme,differential equation first-order,model mathematical,model differential equation,model computational,exp math notation,finite difference method,mesh,mesh uniform,mesh points,forward difference approximation,difference forward,Forward Euler scheme,Euler's method,numerical scheme,demo function,logistic model carrying capacity,SIR model,compartment model,mathematical modeling,scalar ODE,ODE scalar,vector ODE,ODE vector,system of ODEs,asarray (function),function asarray,discontinuous coefficient,spring oscillations,spring damping of,differential equation second-order,simple pendulum,second-order ODE rewritten as two first-order ODEs,difference forward,difference backward,Heun's method,Runge-Kutta, 2nd-order method,2nd-order Runge-Kutta method,RK2,difference centered,nonlinear algebraic equation,Runge-Kutta-Fehlberg,Crank-Nicolson method,spring damping of,spring nonlinear,spring linear,scaling,resonance,Verlet integration,Crank-Nicolson method,Taylor series,PDE,heat equation,diffusion equation,source term,domain,initial conditions,boundary conditions,MOL forward Euler,method of lines,MOL,mesh points,cell,method of lines,class,closure,unstable solutions,instability,stability criterion,scaling,vectorization,tridiagonal matrix,matrix tridiagonal,theta rule,Poisson equation,Laplace equation,root finding,brute force method,code robust,divergence,code exception,code try-except,Newton starting value,sys.exit,exit (sys),return None,rate of convergence,Idle,Emacs,Vim,Gedit,TextWrangler,Notepad++">

<title>Programming for Computations - A Gentle Introduction to Numerical Simulations with Python</title>

<!-- Bootstrap style: bootswatch_journal -->
<link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/journal/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
/* Let pre tags for code blocks have the same color as the surroundings */
pre { color: inherit; background-color: transparent; }

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}
</style>


</head>

<!-- tocinfo
{'highest level': 0,
 'sections': [(u'Preface', 0, None, '___sec0'),
              (u'Why learn programming?', 3, None, '___sec1'),
              (u'Target audience and background knowledge',
               3,
               None,
               '___sec2'),
              (u'Numerical methods', 3, None, '___sec3'),
              (u'The computer language: Python', 3, None, '___sec4'),
              (u'How this book is different', 3, None, '___sec5'),
              (u'Acknowledgments', 3, None, '___sec6'),
              (u'The first few steps',
               0,
               u'1st:TheFirstFewSteps',
               u'1st:TheFirstFewSteps'),
              (u'What is a program? And what is programming?',
               1,
               None,
               '___sec8'),
              (u'A Python program with variables', 1, u'1st:ex1', u'1st:ex1'),
              (u'The program', 2, None, '___sec10'),
              (u'Dissection of the program', 2, None, '___sec11'),
              (u'Why not just use a pocket calculator?', 2, None, '___sec12'),
              (u'The importance of using a text editor to write programs',
               2,
               None,
               '___sec13'),
              (u'Installation of Python', 2, None, '___sec14'),
              (u'Write and run your first program', 2, None, '___sec15'),
              (u'A Python program with a library function',
               1,
               u'1st:ex2',
               u'1st:ex2'),
              (u'A Python program with vectorization and plotting',
               1,
               u'1st:ex3',
               u'1st:ex3'),
              (u'More basic concepts', 1, None, '___sec18'),
              (u'Using Python interactively', 2, None, '___sec19'),
              (u'Arithmetics, parentheses and rounding errors',
               2,
               None,
               '___sec20'),
              (u'Variables and objects', 2, None, '___sec21'),
              (u'Integer division', 2, None, '___sec22'),
              (u'Formatting text and numbers', 2, None, '___sec23'),
              (u'Arrays', 2, None, '___sec24'),
              (u'Plotting', 2, None, '___sec25'),
              (u'Error messages and warnings', 2, None, '___sec26'),
              (u'Input data', 2, None, '___sec27'),
              (u'Symbolic computations', 2, None, '___sec28'),
              (u'Concluding remarks', 2, None, '___sec29'),
              (u'Exercises', 1, None, '___sec30'),
              (u'Exercise 1: Error messages',
               2,
               u'1st:exer:ErrorMessages',
               u'1st:exer:ErrorMessages'),
              (u'Exercise 2: Volume of a cube',
               2,
               u'1st:exer:cubeVolume',
               u'1st:exer:cubeVolume'),
              (u'Exercise 3: Area and circumference of a circle',
               2,
               u'1st:exer:areaCircle',
               u'1st:exer:areaCircle'),
              (u'Exercise 4: Volumes of three cubes',
               2,
               u'1st:exer:volumes3cubes',
               u'1st:exer:volumes3cubes'),
              (u'Exercise 5: Average of integers',
               2,
               u'1st:exer:averageOf5Integers',
               u'1st:exer:averageOf5Integers'),
              (u'Exercise 6: Interactive computing of volume and area',
               2,
               u'1st:exer:cubeVolInteractively',
               u'1st:exer:cubeVolInteractively'),
              (u'Exercise 7: Peculiar results from division',
               2,
               u'1st:exer:intDivInteractively',
               u'1st:exer:intDivInteractively'),
              (u'Exercise 8: Update variable at command prompt',
               2,
               u'1st:exer:updateVarInteractively',
               u'1st:exer:updateVarInteractively'),
              (u'Exercise 9: Formatted print to screen',
               2,
               u'1st:exer:printfScreen',
               u'1st:exer:printfScreen'),
              (u'Exercise 10: Python documentation and random numbers',
               2,
               u'1st:exer:PythonDocRandom',
               u'1st:exer:PythonDocRandom'),
              (u'Basic constructions',
               0,
               u'2nd:BasicConstructins',
               u'2nd:BasicConstructins'),
              (u'If tests, colon and indentation', 1, None, '___sec42'),
              (u'Functions', 1, u'sec:functions', u'sec:functions'),
              (u'For loops', 1, u'sec:for:loops', u'sec:for:loops'),
              (u'While loops', 1, u'sec:while:loops', u'sec:while:loops'),
              (u'Lists and tuples - alternatives to arrays',
               1,
               u'sec:lists',
               u'sec:lists'),
              (u'Reading from and writing to files',
               1,
               u'sec:file:reading:writing',
               u'sec:file:reading:writing'),
              (u'Exercises', 1, None, '___sec48'),
              (u'Exercise 11: Errors with colon, indent, etc.',
               2,
               u'2nd:exer:ErrorsColonIndent',
               u'2nd:exer:ErrorsColonIndent'),
              (u'Exercise 12: Compare integers a and b',
               2,
               u'2nd:exer:compInt',
               u'2nd:exer:compInt'),
              (u'Exercise 13: Functions for circumference and area of a circle',
               2,
               u'2nd:exer:funcCircArea',
               u'2nd:exer:funcCircArea'),
              (u'Exercise 14: Function for area of a rectangle',
               2,
               u'2nd:exer:funcAreaRectangle',
               u'2nd:exer:funcAreaRectangle'),
              (u'Exercise 15: Area of a polygon',
               2,
               u'2nd:exer:area:polygon',
               u'2nd:exer:area:polygon'),
              (u'Exercise 16: Average of integers',
               2,
               u'2nd:exer:avNInt',
               u'2nd:exer:avNInt'),
              (u'Exercise 17: While loop with errors',
               2,
               u'2nd:exer:whileLoopErrors',
               u'2nd:exer:whileLoopErrors'),
              (u'Exercise 18: Area of rectangle versus circle',
               2,
               u'2nd:exer:areaRectCircle',
               u'2nd:exer:areaRectCircle'),
              (u'Exercise 19: Find crossing points of two graphs',
               2,
               u'2nd:exer:Cross2Graphs',
               u'2nd:exer:Cross2Graphs'),
              (u'Exercise 20: Sort array with numbers',
               2,
               u'2nd:exer:sortNumbers',
               u'2nd:exer:sortNumbers'),
              (u'Exercise 21: Compute $\\pi$',
               2,
               u'2nd:exer:computingPi',
               u'2nd:exer:computingPi'),
              (u'Exercise 22: Compute combinations of sets',
               2,
               u'2nd:exer:combinatorics1',
               u'2nd:exer:combinatorics1'),
              (u'Exercise 23: Frequency of random numbers',
               2,
               u'2nd:exer:numberOccurrence',
               u'2nd:exer:numberOccurrence'),
              (u'Remarks', 3, None, '___sec62'),
              (u'Exercise 24: Game 21',
               2,
               u'2nd:exer:Game21',
               u'2nd:exer:Game21'),
              (u'Exercise 25: Linear interpolation',
               2,
               u'2nd:exer:linearInterpol',
               u'2nd:exer:linearInterpol'),
              (u'Exercise 26: Test straight line requirement',
               2,
               u'2nd:exer:testStraightLine',
               u'2nd:exer:testStraightLine'),
              (u'Exercise 27: Fit straight line to data',
               2,
               u'2nd:exer:fitLine',
               u'2nd:exer:fitLine'),
              (u'Remarks', 3, None, '___sec67'),
              (u'Exercise 28: Fit sines to straight line',
               2,
               u'2nd:exer:fitSines',
               u'2nd:exer:fitSines'),
              (u'Remarks', 3, None, '___sec69'),
              (u'Exercise 29: Count occurrences of a string in a string',
               2,
               u'2nd:exer:countTextString',
               u'2nd:exer:countTextString'),
              (u'Remarks', 3, None, '___sec71'),
              (u'Computing integrals', 0, u'sec:integrals', u'sec:integrals'),
              (u'Basic ideas of numerical integration',
               1,
               u'sec:integrals:basic',
               u'sec:integrals:basic'),
              (u'Computational example', 3, None, '___sec74'),
              (u'The composite trapezoidal rule',
               1,
               u'sec:integrals:trap',
               u'sec:integrals:trap'),
              (u'The general formula',
               2,
               u'sec:integrals:formula',
               u'sec:integrals:formula'),
              (u'Implementation',
               2,
               u'sec:integrals:trap:impl',
               u'sec:integrals:trap:impl'),
              (u'Specific or general implementation?', 3, None, '___sec78'),
              (u'Implementation with functions', 3, None, '___sec79'),
              (u'Solving our specific problem in a session',
               3,
               None,
               '___sec80'),
              (u'Solving our specific problem in a program',
               3,
               None,
               '___sec81'),
              (u'Making a module', 2, None, '___sec82'),
              (u'Alternative flat special-purpose implementation',
               2,
               None,
               '___sec83'),
              (u'The composite midpoint method',
               1,
               u'sec:integrals:Midpoint',
               u'sec:integrals:Midpoint'),
              (u'The idea', 3, None, '___sec85'),
              (u'The general formula', 2, None, '___sec86'),
              (u'Implementation',
               2,
               u'sec:midpoint:code',
               u'sec:midpoint:code'),
              (u'Comparing the trapezoidal and the midpoint methods',
               2,
               None,
               '___sec88'),
              (u'Testing', 1, None, '___sec89'),
              (u'Problems with brief testing procedures',
               2,
               None,
               '___sec90'),
              (u'Proper test procedures',
               2,
               u'sec:integrals:testprocs',
               u'sec:integrals:testprocs'),
              (u'Hand-computed results', 3, None, '___sec92'),
              (u'Solving a problem without numerical errors',
               3,
               None,
               '___sec93'),
              (u'Demonstrating correct convergence rates',
               3,
               None,
               '___sec94'),
              (u'Finite precision of floating-point numbers',
               2,
               u'sec:integrals:finite_prec',
               u'sec:integrals:finite_prec'),
              (u'Constructing unit tests and writing test functions',
               2,
               u'sec:integrals:test:functions',
               u'sec:integrals:test:functions'),
              (u'Hand-computed numerical results', 3, None, '___sec97'),
              (u'Solving a problem without numerical errors',
               3,
               None,
               '___sec98'),
              (u'Demonstrating correct convergence rates',
               3,
               None,
               '___sec99'),
              (u'Vectorization', 1, None, '___sec100'),
              (u'Vectorizing the midpoint rule', 3, None, '___sec101'),
              (u'Vectorizing the trapezoidal rule', 3, None, '___sec102'),
              (u'Measuring computational speed', 1, None, '___sec103'),
              (u'Double and triple integrals',
               1,
               u'sec:int:double',
               u'sec:int:double'),
              (u'The midpoint rule for a double integral',
               2,
               u'sec:int:double:midpoint',
               u'sec:int:double:midpoint'),
              (u'Derivation via one-dimensional integrals',
               3,
               None,
               '___sec106'),
              (u'Direct derivation', 3, None, '___sec107'),
              (u'Programming a double sum', 3, None, '___sec108'),
              (u'Reusing code for one-dimensional integrals',
               3,
               None,
               '___sec109'),
              (u'Verification via test functions', 3, None, '___sec110'),
              (u'The midpoint rule for a triple integral',
               2,
               None,
               '___sec111'),
              (u'Theory', 3, None, '___sec112'),
              (u'Implementation', 3, None, '___sec113'),
              (u'Monte Carlo integration for complex-shaped domains',
               2,
               u'sec:int:complex:domain',
               u'sec:int:complex:domain'),
              (u'The Monte Carlo integration algorithm',
               3,
               None,
               '___sec115'),
              (u'Implementation', 3, None, '___sec116'),
              (u'Verification', 3, None, '___sec117'),
              (u'Test function for function with random numbers',
               3,
               None,
               '___sec118'),
              (u'Integral over a circle', 3, None, '___sec119'),
              (u'Exercises', 1, None, '___sec120'),
              (u'Exercise 30: Hand calculations for the trapezoidal method',
               2,
               u'sec:exer:trap:hand',
               u'sec:exer:trap:hand'),
              (u'Exercise 31: Hand calculations for the midpoint method',
               2,
               u'sec:exer:midpt:hand',
               u'sec:exer:midpt:hand'),
              (u'Exercise 32: Compute a simple integral',
               2,
               u'sec:exer:trap:mid:parabola',
               u'sec:exer:trap:mid:parabola'),
              (u'Exercise 33: Hand-calculations with sine integrals',
               2,
               u'sec:exer:hand:sine',
               u'sec:exer:hand:sine'),
              (u'Exercise 34: Make test functions for the midpoint method',
               2,
               u'sec:exer:test:midpoint',
               u'sec:exer:test:midpoint'),
              (u'Exercise 35: Explore rounding errors with large numbers',
               2,
               u'sec:exer:test:roundoff',
               u'sec:exer:test:roundoff'),
              (u'Exercise 36: Write test functions for $\\int_0^4\\sqrt{x}dx$',
               2,
               u'sec:exer:test:convrates:sqrt',
               u'sec:exer:test:convrates:sqrt'),
              (u'Remarks', 3, None, '___sec128'),
              (u'Exercise 37: Rectangle methods',
               2,
               u'sec:exer:rectangleMethod',
               u'sec:exer:rectangleMethod'),
              (u'Exercise 38: Adaptive integration',
               2,
               u'sec:exer:adaptive:int',
               u'sec:exer:adaptive:int'),
              (u'Remarks', 3, None, '___sec131'),
              (u'Exercise 39: Integrating x raised to x',
               2,
               u'sec:exer:integrate:x2x',
               u'sec:exer:integrate:x2x'),
              (u'Exercise 40: Integrate products of sine functions',
               2,
               u'sec:exer:sine:products',
               u'sec:exer:sine:products'),
              (u'Exercise 41: Revisit fit of sines to a function',
               2,
               u'sec:exer:revisitFitSines',
               u'sec:exer:revisitFitSines'),
              (u'Exercise 42: Derive the trapezoidal rule for a double integral',
               2,
               u'sec:exer:trapezoidal:2D',
               u'sec:exer:trapezoidal:2D'),
              (u'Exercise 43: Compute the area of a triangle by Monte Carlo integration',
               2,
               u'sec:exer:MC:ellipse',
               u'sec:exer:MC:ellipse'),
              (u'Solving ordinary differential equations',
               0,
               u'5th:SolvODEs',
               u'5th:SolvODEs'),
              (u'Population growth', 1, u'sec:de:pg', u'sec:de:pg'),
              (u'Derivation of the model',
               2,
               u'sec:de:pg:model',
               u'sec:de:pg:model'),
              (u'Numerical solution',
               2,
               u'sec:de:pg:numerics',
               u'sec:de:pg:numerics'),
              (u'Programming the Forward Euler scheme; the special case',
               2,
               u'sec:de:pg:prog1',
               u'sec:de:pg:prog1'),
              (u'Understanding the Forward Euler method',
               2,
               u'sec:de:pg:geom',
               u'sec:de:pg:geom'),
              (u'Programming the Forward Euler scheme; the general case',
               2,
               u'sec:de:FE:gen',
               u'sec:de:FE:gen'),
              (u'Making the population growth model more realistic',
               2,
               None,
               '___sec144'),
              (u'Verification: exact linear solution of the discrete equations',
               2,
               u'sec:de:growth:test:linear',
               u'sec:de:growth:test:linear'),
              (u'Spreading of diseases', 1, None, '___sec146'),
              (u'Spreading of a flu', 2, u'sec:de:flu', u'sec:de:flu'),
              (u'A Forward Euler method for the differential equation system',
               2,
               u'sec:de:flu:FE',
               u'sec:de:flu:FE'),
              (u'Programming the numerical method; the special case',
               2,
               u'sec:de:flu:prog:spec',
               u'sec:de:flu:prog:spec'),
              (u'Outbreak or not', 2, None, '___sec150'),
              (u'Abstract problem and notation',
               2,
               u'sec:de:flu:generic',
               u'sec:de:flu:generic'),
              (u'Programming the numerical method; the general case',
               2,
               u'sec:de:flu:prog:generic',
               u'sec:de:flu:prog:generic'),
              (u'Time-restricted immunity', 2, None, '___sec153'),
              (u'Incorporating vaccination',
               2,
               u'sec:de:flu:vaccine',
               u'sec:de:flu:vaccine'),
              (u'Discontinuous coefficients: a vaccination campaign',
               2,
               u'sec:de:flu:vaccine:discont',
               u'sec:de:flu:vaccine:discont'),
              (u'Oscillating one-dimensional systems',
               1,
               u'sec:de:vib',
               u'sec:de:vib'),
              (u'Derivation of a simple model', 2, None, '___sec157'),
              (u'Numerical solution', 2, None, '___sec158'),
              (u'Programming the numerical method; the special case',
               2,
               u'sec:de:vib:special',
               u'sec:de:vib:special'),
              (u'A magic fix of the numerical method', 2, None, '___sec160'),
              (u"The 2nd-order Runge-Kutta method (or Heun's method)",
               2,
               u'sec:de:osc:Heun',
               u'sec:de:osc:Heun'),
              (u'Software for solving ODEs',
               2,
               u'sec:de:osc:odespy',
               u'sec:de:osc:odespy'),
              (u'The 4th-order Runge-Kutta method', 2, None, '___sec163'),
              (u'The algorithm', 3, None, '___sec164'),
              (u'Application', 3, None, '___sec165'),
              (u'Implementation', 3, None, '___sec166'),
              (u'Derivation', 3, None, '___sec167'),
              (u'More effects: damping, nonlinearity, and external forces',
               2,
               None,
               '___sec168'),
              (u'The Euler-Cromer scheme', 3, None, '___sec169'),
              (u'The 4-th order Runge-Kutta method', 3, None, '___sec170'),
              (u'Illustration of linear damping', 2, None, '___sec171'),
              (u'Illustration of linear damping with sinusoidal excitation',
               2,
               None,
               '___sec172'),
              (u'Spring-mass system with sliding friction',
               2,
               u'sec:de:vib:ode2:sliding:friction',
               u'sec:de:vib:ode2:sliding:friction'),
              (u'A finite difference method; undamped, linear case',
               2,
               u'sec:de:vib:2nd',
               u'sec:de:vib:2nd'),
              (u'A finite difference method; linear damping',
               2,
               u'sec:de:vib:2nd:damped1',
               u'sec:de:vib:2nd:damped1'),
              (u'Exercises', 1, None, '___sec176'),
              (u'Exercise 44: Geometric construction of the Forward Euler method',
               2,
               u'sec:de:exer:geom',
               u'sec:de:exer:geom'),
              (u'Exercise 45: Make test functions for the Forward Euler method',
               2,
               u'sec:de:exer:FE:test1',
               u'sec:de:exer:FE:test1'),
              (u"Exercise 46: Implement and evaluate Heun's method",
               2,
               u'sec:de:exer:Heun:pg',
               u'sec:de:exer:Heun:pg'),
              (u'Exercise 47: Find an appropriate time step; logistic model',
               2,
               u'sec:de:exer:logistic:dtopt',
               u'sec:de:exer:logistic:dtopt'),
              (u'Exercise 48: Find an appropriate time step; SIR model',
               2,
               u'sec:de:exer:SIR:dtopt',
               u'sec:de:exer:SIR:dtopt'),
              (u'Exercise 49: Model an adaptive vaccination campaign',
               2,
               u'sec:de:exer:SIRV:padapt',
               u'sec:de:exer:SIRV:padapt'),
              (u'Exercise 50: Make a SIRV model with time-limited effect of vaccination',
               2,
               u'sec:de:exer:SIRV:padapt_time_limited',
               u'sec:de:exer:SIRV:padapt_time_limited'),
              (u'Exercise 51: Refactor a flat program',
               2,
               u'sec:de:exer:vib:FE:func',
               u'sec:de:exer:vib:FE:func'),
              (u'Exercise 52: Simulate oscillations by a general ODE solver',
               2,
               u'sec:de:exer:vib:ode_FE',
               u'sec:de:exer:vib:ode_FE'),
              (u'Exercise 53: Compute the energy in oscillations',
               2,
               u'sec:de:exer:vib:energy',
               u'sec:de:exer:vib:energy'),
              (u'Exercise 54: Use a Backward Euler scheme for population growth',
               2,
               u'sec:de:exer:pg:BE',
               u'sec:de:exer:pg:BE'),
              (u'Exercise 55: Use a Crank-Nicolson scheme for population growth',
               2,
               u'sec:de:exer:pg:CN',
               u'sec:de:exer:pg:CN'),
              (u'Exercise 56: Understand finite differences via Taylor series',
               2,
               u'sec:de:exer:fd:Taylor',
               u'sec:de:exer:fd:Taylor'),
              (u'Exercise 57: Use a Backward Euler scheme for oscillations',
               2,
               u'sec:de:exer:vib:BE',
               u'sec:de:exer:vib:BE'),
              (u'Remarks', 3, None, '___sec191'),
              (u"Exercise 58: Use Heun's method for the SIR model",
               2,
               u'sec:de:exer:SIR:Heun',
               u'sec:de:exer:SIR:Heun'),
              (u'Exercise 59: Use Odespy to solve a simple ODE',
               2,
               u'sec:de:exer:odespy:decay',
               u'sec:de:exer:odespy:decay'),
              (u'Exercise 60: Set up a Backward Euler scheme for oscillations',
               2,
               u'sec:de:exer:osc:BE',
               u'sec:de:exer:osc:BE'),
              (u'Exercise 61: Set up a Forward Euler scheme for nonlinear and damped oscillations',
               2,
               u'sec:de:exer:osc:FE:general',
               u'sec:de:exer:osc:FE:general'),
              (u'Exercise 62: Discretize an initial condition',
               2,
               u'sec:de:exer:osc:2nd:V0ic',
               u'sec:de:exer:osc:2nd:V0ic'),
              (u'Solving partial differential equations',
               0,
               u'6th:SolvPDEs',
               u'6th:SolvPDEs'),
              (u'Finite difference methods',
               1,
               u'6th:SolvPDEs:MOLandFE',
               u'6th:SolvPDEs:MOLandFE'),
              (u'Reduction of a PDE to a system of ODEs',
               2,
               u'sec:pde:diff1D:reduce',
               u'sec:pde:diff1D:reduce'),
              (u'Construction of a test problem with known discrete solution',
               2,
               u'sec:pde:diff1D:testproblem',
               u'sec:pde:diff1D:testproblem'),
              (u'Implementation: Forward Euler method', 2, None, '___sec201'),
              (u'Application: heat conduction in a rod',
               2,
               u'sec:pde:diff1D:rod',
               u'sec:pde:diff1D:rod'),
              (u'Vectorization', 2, None, '___sec203'),
              (u'Using Odespy to solve the system of ODEs',
               2,
               None,
               '___sec204'),
              (u'Implicit methods', 2, None, '___sec205'),
              (u'Exercises', 1, None, '___sec206'),
              (u'Exercise 63: Simulate a diffusion equation by hand',
               2,
               u'sec:pde:diff1D:exer:handFE',
               u'sec:pde:diff1D:exer:handFE'),
              (u'Exercise 64: Compute temperature variations in the ground',
               2,
               u'sec:pde:diff1D:exer:groundtemp',
               u'sec:pde:diff1D:exer:groundtemp'),
              (u'Exercise 65: Compare implicit methods',
               2,
               u'sec:pde:diff1D:exer:compare:implicit',
               u'sec:pde:diff1D:exer:compare:implicit'),
              (u'Exercise 66: Explore adaptive and implicit methods',
               2,
               u'sec:pde:diff1D:exer:groundtemp:adapt',
               u'sec:pde:diff1D:exer:groundtemp:adapt'),
              (u'Exercise 67: Investigate the $\\theta$ rule',
               2,
               u'sec:pde:diff1D:exer:CN',
               u'sec:pde:diff1D:exer:CN'),
              (u'Remarks', 3, None, '___sec212'),
              (u'Exercise 68: Compute the diffusion of a Gaussian peak',
               2,
               u'sec:pde:diff1D:exer:Gaussian',
               u'sec:pde:diff1D:exer:Gaussian'),
              (u'Remarks', 3, None, '___sec214'),
              (u'Exercise 69: Vectorize a function for computing the area of a polygon',
               2,
               u'2nd:exer:area:polygon2',
               u'2nd:exer:area:polygon2'),
              (u'Exercise 70: Explore symmetry',
               2,
               u'sec:pde:diff1D:exer:Gaussian:symm',
               u'sec:pde:diff1D:exer:Gaussian:symm'),
              (u'Remarks', 3, None, '___sec217'),
              (u'Exercise 71: Compute solutions as $t\\rightarrow\\infty$',
               2,
               u'sec:pde:diff1D:exer:stationary',
               u'sec:pde:diff1D:exer:stationary'),
              (u'Remarks', 3, None, '___sec219'),
              (u'Exercise 72: Solve a two-point boundary value problem',
               2,
               u'sec:pde:diff1D:exer:stationary2',
               u'sec:pde:diff1D:exer:stationary2'),
              (u'Solving nonlinear algebraic equations',
               0,
               u'4th:NonlinAlgEq',
               u'4th:NonlinAlgEq'),
              (u'Brute force methods',
               1,
               u'4th:bruteforce',
               u'4th:bruteforce'),
              (u'Brute force root finding', 2, None, '___sec223'),
              (u'Numerical algorithm', 3, None, '___sec224'),
              (u'Implementation', 3, None, '___sec225'),
              (u'Brute force optimization', 2, None, '___sec226'),
              (u'Numerical algorithm', 3, None, '___sec227'),
              (u'Implementation', 3, None, '___sec228'),
              (u'Model problem for algebraic equations',
               2,
               None,
               '___sec229'),
              (u"Newton's method",
               1,
               u'4th:NonlinAlgEq:Newt',
               u'4th:NonlinAlgEq:Newt'),
              (u"Deriving and implementing Newton's method",
               2,
               None,
               '___sec231'),
              (u'Making a more efficient and robust implementation',
               2,
               u'4th:Newton:robust',
               u'4th:Newton:robust'),
              (u'The secant method',
               1,
               u'4th:NonlinAlgEq:Secant',
               u'4th:NonlinAlgEq:Secant'),
              (u'The bisection method',
               1,
               u'4th:NonlinAlgEq:Bisect',
               u'4th:NonlinAlgEq:Bisect'),
              (u'Rate of convergence',
               1,
               u'4th:NonlinAlgEq:RateConv',
               u'4th:NonlinAlgEq:RateConv'),
              (u'Solving multiple nonlinear algebraic equations',
               1,
               u'nonlin:Newton:systems',
               u'nonlin:Newton:systems'),
              (u'Abstract notation',
               2,
               u'nonlin:Newton:systems:notation',
               u'nonlin:Newton:systems:notation'),
              (u'Taylor expansions for multi-variable functions',
               2,
               None,
               '___sec238'),
              (u"Newton's method", 2, None, '___sec239'),
              (u'Implementation', 2, None, '___sec240'),
              (u'Exercises', 1, None, '___sec241'),
              (u"Exercise 73: Understand why Newton's method can fail",
               2,
               u'4th:exer:Newton:failure',
               u'4th:exer:Newton:failure'),
              (u'Exercise 74: See if the secant method fails',
               2,
               u'4th:exer:Secant:failure',
               u'4th:exer:Secant:failure'),
              (u'Exercise 75: Understand why the bisection method cannot fail',
               2,
               u'4th:exer:Bisection:failure',
               u'4th:exer:Bisection:failure'),
              (u"Exercise 76: Combine the bisection method with Newton's method",
               2,
               u'4th:exer:Bisection:Newton',
               u'4th:exer:Bisection:Newton'),
              (u"Exercise 77: Write a test function for Newton's method",
               2,
               u'4th:exer:NewtonHand',
               u'4th:exer:NewtonHand'),
              (u'Exercise 78: Solve nonlinear equation for a vibrating beam',
               2,
               u'4th:exer:beam:vib',
               u'4th:exer:beam:vib'),
              (u'Appendix: Getting access to Python',
               0,
               u'app:accesspy',
               u'app:accesspy'),
              (u'Required software',
               1,
               u'sec:accesspy:softwarelist',
               u'sec:accesspy:softwarelist'),
              (u'Anaconda and Spyder',
               1,
               u'sec:accesspy:anaconda',
               u'sec:accesspy:anaconda'),
              (u'Spyder on Mac', 2, None, '___sec251'),
              (u'Installation of additional packages', 2, None, '___sec252'),
              (u'How to write and run a Python program',
               1,
               u'sec:accesspy:writerun',
               u'sec:accesspy:writerun'),
              (u'The need for a text editor', 2, None, '___sec254'),
              (u'Text editors', 2, None, '___sec255'),
              (u'Terminal windows', 2, None, '___sec256'),
              (u'Using a plain text editor and a terminal window',
               2,
               None,
               '___sec257'),
              (u'Spyder', 2, None, '___sec258'),
              (u'The SageMathCloud and Wakari web services',
               1,
               u'sec:accesspy:sagemath:wakari',
               u'sec:accesspy:sagemath:wakari'),
              (u'Basic intro to SageMathCloud', 2, None, '___sec260'),
              (u'Basic intro to Wakari', 2, None, '___sec261'),
              (u'Installing your own Python packages', 2, None, '___sec262'),
              (u'Writing IPython notebooks',
               1,
               u'sec:accesspy:ipynb',
               u'sec:accesspy:ipynb'),
              (u'A simple program in the notebook', 2, None, '___sec264'),
              (u'Mixing text, mathematics, code, and graphics',
               2,
               None,
               '___sec265'),
              (u'References', 0, None, '___sec266')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands.tex -->
$$
\newcommand{\Oof}[1]{\mathcal{O}(#1)}
\newcommand{\F}{\boldsymbol{F}}
\newcommand{\J}{\boldsymbol{J}}
\newcommand{\x}{\boldsymbol{x}}
\renewcommand{\c}{\boldsymbol{c}}
$$




    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="p4c-bootstrap-Python.html">Programming for Computations - A Gentle Introduction to Numerical Simulations with Python</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#___sec0" style="font-size: 80%;"><b>Preface</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#___sec1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Why learn programming?</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#___sec2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Target audience and background knowledge</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#___sec3" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Numerical methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#___sec4" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The computer language: Python</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#___sec5" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;How this book is different</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#___sec6" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Acknowledgments</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python003.html#1st:TheFirstFewSteps" style="font-size: 80%;"><b>The first few steps</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python003.html#___sec8" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;What is a program? And what is programming?</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python004.html#1st:ex1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;A Python program with variables</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python004.html#___sec10" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The program</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python004.html#___sec11" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dissection of the program</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python004.html#___sec12" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Why not just use a pocket calculator?</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python004.html#___sec13" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The importance of using a text editor to write programs</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python004.html#___sec14" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Installation of Python</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python004.html#___sec15" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write and run your first program</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python005.html#1st:ex2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;A Python program with a library function</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python006.html#1st:ex3" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;A Python program with vectorization and plotting</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec18" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;More basic concepts</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec19" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Using Python interactively</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec20" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arithmetics, parentheses and rounding errors</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec21" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variables and objects</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec22" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer division</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec23" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Formatting text and numbers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec24" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arrays</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec25" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Plotting</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec26" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error messages and warnings</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec27" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Input data</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec28" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Symbolic computations</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#___sec29" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Concluding remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#___sec30" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercises</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:ErrorMessages" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 1: Error messages</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:cubeVolume" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 2: Volume of a cube</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:areaCircle" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 3: Area and circumference of a circle</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:volumes3cubes" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 4: Volumes of three cubes</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:averageOf5Integers" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 5: Average of integers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:cubeVolInteractively" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 6: Interactive computing of volume and area</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:intDivInteractively" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 7: Peculiar results from division</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:updateVarInteractively" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 8: Update variable at command prompt</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:printfScreen" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 9: Formatted print to screen</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python008.html#1st:exer:PythonDocRandom" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 10: Python documentation and random numbers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python009.html#2nd:BasicConstructins" style="font-size: 80%;"><b>Basic constructions</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python009.html#___sec42" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;If tests, colon and indentation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python010.html#sec:functions" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Functions</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python011.html#sec:for:loops" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;For loops</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python012.html#sec:while:loops" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;While loops</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python013.html#sec:lists" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Lists and tuples - alternatives to arrays</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python013.html#sec:file:reading:writing" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Reading from and writing to files</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#___sec48" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercises</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:ErrorsColonIndent" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 11: Errors with colon, indent, etc.</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:compInt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 12: Compare integers a and b</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:funcCircArea" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 13: Functions for circumference and area of a circle</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:funcAreaRectangle" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 14: Function for area of a rectangle</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:area:polygon" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 15: Area of a polygon</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:avNInt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 16: Average of integers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:whileLoopErrors" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 17: While loop with errors</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:areaRectCircle" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 18: Area of rectangle versus circle</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:Cross2Graphs" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 19: Find crossing points of two graphs</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:sortNumbers" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 20: Sort array with numbers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:computingPi" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 21: Compute \( \pi \)</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:combinatorics1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 22: Compute combinations of sets</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:numberOccurrence" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 23: Frequency of random numbers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#___sec62" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:Game21" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 24: Game 21</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:linearInterpol" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 25: Linear interpolation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:testStraightLine" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 26: Test straight line requirement</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:fitLine" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 27: Fit straight line to data</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#___sec67" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:fitSines" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 28: Fit sines to straight line</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#___sec69" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#2nd:exer:countTextString" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 29: Count occurrences of a string in a string</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python014.html#___sec71" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python015.html#sec:integrals" style="font-size: 80%;"><b>Computing integrals</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python015.html#sec:integrals:basic" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Basic ideas of numerical integration</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python015.html#___sec74" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Computational example</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#sec:integrals:trap" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The composite trapezoidal rule</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#sec:integrals:formula" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The general formula</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#sec:integrals:trap:impl" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#___sec78" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Specific or general implementation?</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#___sec79" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation with functions</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#___sec80" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solving our specific problem in a session</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#___sec81" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solving our specific problem in a program</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#___sec82" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Making a module</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python016.html#___sec83" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Alternative flat special-purpose implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:integrals:Midpoint" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The composite midpoint method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec85" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The idea</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec86" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The general formula</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:midpoint:code" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec88" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comparing the trapezoidal and the midpoint methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec89" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Testing</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec90" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Problems with brief testing procedures</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:integrals:testprocs" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Proper test procedures</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec92" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hand-computed results</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec93" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solving a problem without numerical errors</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec94" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstrating correct convergence rates</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:integrals:finite_prec" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Finite precision of floating-point numbers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:integrals:test:functions" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constructing unit tests and writing test functions</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec97" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hand-computed numerical results</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec98" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solving a problem without numerical errors</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec99" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstrating correct convergence rates</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec100" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Vectorization</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec101" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vectorizing the midpoint rule</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec102" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vectorizing the trapezoidal rule</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec103" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Measuring computational speed</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:int:double" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Double and triple integrals</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:int:double:midpoint" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The midpoint rule for a double integral</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec106" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Derivation via one-dimensional integrals</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec107" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Direct derivation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec108" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Programming a double sum</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec109" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reusing code for one-dimensional integrals</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec110" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verification via test functions</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec111" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The midpoint rule for a triple integral</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec112" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Theory</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec113" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#sec:int:complex:domain" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Monte Carlo integration for complex-shaped domains</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec115" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The Monte Carlo integration algorithm</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec116" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec117" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verification</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec118" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Test function for function with random numbers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#___sec119" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integral over a circle</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#___sec120" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercises</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:trap:hand" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 30: Hand calculations for the trapezoidal method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:midpt:hand" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 31: Hand calculations for the midpoint method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:trap:mid:parabola" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 32: Compute a simple integral</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:hand:sine" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 33: Hand-calculations with sine integrals</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:test:midpoint" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 34: Make test functions for the midpoint method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:test:roundoff" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 35: Explore rounding errors with large numbers</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:test:convrates:sqrt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 36: Write test functions for \( \int_0^4\sqrt{x}dx \)</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#___sec128" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:rectangleMethod" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 37: Rectangle methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:adaptive:int" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 38: Adaptive integration</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#___sec131" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:integrate:x2x" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 39: Integrating x raised to x</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:sine:products" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 40: Integrate products of sine functions</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:revisitFitSines" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 41: Revisit fit of sines to a function</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:trapezoidal:2D" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 42: Derive the trapezoidal rule for a double integral</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python018.html#sec:exer:MC:ellipse" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 43: Compute the area of a triangle by Monte Carlo integration</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python019.html#5th:SolvODEs" style="font-size: 80%;"><b>Solving ordinary differential equations</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#sec:de:pg" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Population growth</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#sec:de:pg:model" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Derivation of the model</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#sec:de:pg:numerics" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Numerical solution</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#sec:de:pg:prog1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Programming the Forward Euler scheme; the special case</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#sec:de:pg:geom" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Understanding the Forward Euler method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#sec:de:FE:gen" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Programming the Forward Euler scheme; the general case</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#___sec144" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Making the population growth model more realistic</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python020.html#sec:de:growth:test:linear" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verification: exact linear solution of the discrete equations</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#___sec146" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Spreading of diseases</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#sec:de:flu" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Spreading of a flu</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#sec:de:flu:FE" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A Forward Euler method for the differential equation system</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#sec:de:flu:prog:spec" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Programming the numerical method; the special case</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#___sec150" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Outbreak or not</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#sec:de:flu:generic" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Abstract problem and notation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#sec:de:flu:prog:generic" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Programming the numerical method; the general case</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#___sec153" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time-restricted immunity</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#sec:de:flu:vaccine" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Incorporating vaccination</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python021.html#sec:de:flu:vaccine:discont" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Discontinuous coefficients: a vaccination campaign</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#sec:de:vib" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Oscillating one-dimensional systems</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec157" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Derivation of a simple model</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec158" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Numerical solution</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#sec:de:vib:special" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Programming the numerical method; the special case</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec160" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A magic fix of the numerical method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#sec:de:osc:Heun" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The 2nd-order Runge-Kutta method (or Heun's method)</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#sec:de:osc:odespy" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Software for solving ODEs</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec163" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The 4th-order Runge-Kutta method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec164" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The algorithm</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec165" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec166" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec167" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Derivation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec168" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;More effects: damping, nonlinearity, and external forces</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec169" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The Euler-Cromer scheme</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec170" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The 4-th order Runge-Kutta method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec171" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Illustration of linear damping</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#___sec172" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Illustration of linear damping with sinusoidal excitation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#sec:de:vib:ode2:sliding:friction" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Spring-mass system with sliding friction</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#sec:de:vib:2nd" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A finite difference method; undamped, linear case</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#sec:de:vib:2nd:damped1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A finite difference method; linear damping</a></li>
     <!-- navigation toc: --> <li><a href="#___sec176" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercises</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:geom" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 44: Geometric construction of the Forward Euler method</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:FE:test1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 45: Make test functions for the Forward Euler method</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:Heun:pg" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 46: Implement and evaluate Heun's method</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:logistic:dtopt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 47: Find an appropriate time step; logistic model</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:SIR:dtopt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 48: Find an appropriate time step; SIR model</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:SIRV:padapt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 49: Model an adaptive vaccination campaign</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:SIRV:padapt_time_limited" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 50: Make a SIRV model with time-limited effect of vaccination</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:vib:FE:func" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 51: Refactor a flat program</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:vib:ode_FE" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 52: Simulate oscillations by a general ODE solver</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:vib:energy" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 53: Compute the energy in oscillations</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:pg:BE" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 54: Use a Backward Euler scheme for population growth</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:pg:CN" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 55: Use a Crank-Nicolson scheme for population growth</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:fd:Taylor" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 56: Understand finite differences via Taylor series</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:vib:BE" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 57: Use a Backward Euler scheme for oscillations</a></li>
     <!-- navigation toc: --> <li><a href="#___sec191" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:SIR:Heun" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 58: Use Heun's method for the SIR model</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:odespy:decay" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 59: Use Odespy to solve a simple ODE</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:osc:BE" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 60: Set up a Backward Euler scheme for oscillations</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:osc:FE:general" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 61: Set up a Forward Euler scheme for nonlinear and damped oscillations</a></li>
     <!-- navigation toc: --> <li><a href="#sec:de:exer:osc:2nd:V0ic" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 62: Discretize an initial condition</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python024.html#6th:SolvPDEs" style="font-size: 80%;"><b>Solving partial differential equations</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#6th:SolvPDEs:MOLandFE" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Finite difference methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:reduce" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reduction of a PDE to a system of ODEs</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:testproblem" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Construction of a test problem with known discrete solution</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec201" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation: Forward Euler method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:rod" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application: heat conduction in a rod</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec203" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vectorization</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec204" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Using Odespy to solve the system of ODEs</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec205" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implicit methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec206" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercises</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:handFE" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 63: Simulate a diffusion equation by hand</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:groundtemp" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 64: Compute temperature variations in the ground</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:compare:implicit" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 65: Compare implicit methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:groundtemp:adapt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 66: Explore adaptive and implicit methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:CN" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 67: Investigate the \( \theta \) rule</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec212" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:Gaussian" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 68: Compute the diffusion of a Gaussian peak</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec214" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#2nd:exer:area:polygon2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 69: Vectorize a function for computing the area of a polygon</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:Gaussian:symm" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 70: Explore symmetry</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec217" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:stationary" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 71: Compute solutions as \( t\rightarrow\infty \)</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#___sec219" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python025.html#sec:pde:diff1D:exer:stationary2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 72: Solve a two-point boundary value problem</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#4th:NonlinAlgEq" style="font-size: 80%;"><b>Solving nonlinear algebraic equations</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#4th:bruteforce" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Brute force methods</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#___sec223" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Brute force root finding</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#___sec224" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Numerical algorithm</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#___sec225" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#___sec226" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Brute force optimization</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#___sec227" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Numerical algorithm</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#___sec228" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python026.html#___sec229" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Model problem for algebraic equations</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python027.html#4th:NonlinAlgEq:Newt" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Newton's method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python027.html#___sec231" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Deriving and implementing Newton's method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python027.html#4th:Newton:robust" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Making a more efficient and robust implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python028.html#4th:NonlinAlgEq:Secant" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The secant method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python029.html#4th:NonlinAlgEq:Bisect" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The bisection method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python030.html#4th:NonlinAlgEq:RateConv" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Rate of convergence</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python031.html#nonlin:Newton:systems" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Solving multiple nonlinear algebraic equations</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python031.html#nonlin:Newton:systems:notation" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Abstract notation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python031.html#___sec238" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Taylor expansions for multi-variable functions</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python031.html#___sec239" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Newton's method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python031.html#___sec240" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python032.html#___sec241" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercises</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python032.html#4th:exer:Newton:failure" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 73: Understand why Newton's method can fail</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python032.html#4th:exer:Secant:failure" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 74: See if the secant method fails</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python032.html#4th:exer:Bisection:failure" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 75: Understand why the bisection method cannot fail</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python032.html#4th:exer:Bisection:Newton" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 76: Combine the bisection method with Newton's method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python032.html#4th:exer:NewtonHand" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 77: Write a test function for Newton's method</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python032.html#4th:exer:beam:vib" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exercise 78: Solve nonlinear equation for a vibrating beam</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python033.html#app:accesspy" style="font-size: 80%;"><b>Appendix: Getting access to Python</b></a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python034.html#sec:accesspy:softwarelist" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Required software</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python035.html#sec:accesspy:anaconda" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Anaconda and Spyder</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python035.html#___sec251" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Spyder on Mac</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python035.html#___sec252" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Installation of additional packages</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python036.html#sec:accesspy:writerun" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;How to write and run a Python program</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python036.html#___sec254" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The need for a text editor</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python036.html#___sec255" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Text editors</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python036.html#___sec256" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Terminal windows</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python036.html#___sec257" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Using a plain text editor and a terminal window</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python036.html#___sec258" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Spyder</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python037.html#sec:accesspy:sagemath:wakari" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The SageMathCloud and Wakari web services</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python037.html#___sec260" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Basic intro to SageMathCloud</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python037.html#___sec261" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Basic intro to Wakari</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python037.html#___sec262" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Installing your own Python packages</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python038.html#sec:accesspy:ipynb" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Writing IPython notebooks</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python038.html#___sec264" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A simple program in the notebook</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python038.html#___sec265" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mixing text, mathematics, code, and graphics</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python039.html#___sec266" style="font-size: 80%;"><b>References</b></a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0023"></a>
<!-- !split -->

<h1 id="___sec176">Exercises </h1>

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:geom">Exercise 44: Geometric construction of the Forward Euler method</h2>

<p>
The section <a href="._p4c-bootstrap-Python020.html#sec:de:pg:geom">Understanding the Forward Euler method</a> describes a geometric interpretation of
the Forward Euler method. This exercise will demonstrate the geometric
construction of the solution in detail. Consider the differential
equation \( u'=u \) with \( u(0)=1 \). We use time steps \( \Delta t = 1 \).

<p>
<b>a)</b>
Start at \( t=0 \) and draw a straight line with slope \( u'(0)=u(0)=1 \).
Go one time step forward to \( t=\Delta t \) and mark the solution point
on the line.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_44_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_44_1">

<p>
See plot and comments given below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Draw a straight line through the solution point \( (\Delta t, u^1) \)
with slope \( u'(\Delta t)=u^1 \). Go one time step forward to
\( t=2\Delta t \) and mark the solution point on the line.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_44_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_44_2">

<p>
See plot and comments given below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>c)</b>
Draw a straight line through the solution point \( (2\Delta t, u^2) \)
with slope \( u'(2\Delta t)=u^2 \). Go one time step forward to
\( t=3\Delta t \) and mark the solution point on the line.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_44_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_44_3">

<p>
See plot and comments given below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>d)</b>
Set up the Forward Euler scheme for the problem \( u'=u \).
Calculate \( u^1 \), \( u^2 \), and \( u^3 \). Check that the numbers are
the same as obtained in a)-c).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_44_4" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_44_4">

<p>
The code may be written as

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, exp, linspace
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">dudt</span>(u):
    <span style="color: #008000; font-weight: bold">return</span> u

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">u_exact</span>(t):
    <span style="color: #008000; font-weight: bold">return</span> exp(t)

a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; b <span style="color: #666666">=</span> <span style="color: #666666">3</span>
u <span style="color: #666666">=</span> zeros(<span style="color: #666666">4</span>)
u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>
dt <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> [<span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">2</span>]:
    u[i<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> u[i] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>dudt(u[i])

<span style="color: #008000; font-weight: bold">print</span> u
tP <span style="color: #666666">=</span> [<span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">2</span>, <span style="color: #666666">3</span>]
time <span style="color: #666666">=</span> linspace(a, b, <span style="color: #666666">100</span>)
u_true <span style="color: #666666">=</span> u_exact(time)
plt<span style="color: #666666">.</span>plot(time, u_true, <span style="color: #BA2121">&#39;b-&#39;</span>, tP, u, <span style="color: #BA2121">&#39;ro&#39;</span>)
plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;u(t)&#39;</span>)
plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
Running the program will print the numbers 1, 2, 4 and 8, as well as produce the plot seen in
Figure <a href="#fig:FEgeom">51</a>. We see the values computed in a)-c) as circles
(which in a)-c) are connected by straight line segments). For comparison, the true solution
is also given. The very large timestep gives a rather poor numerical solution.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 51:  Forward Euler method (red filled circles) applied to the ode \( u' = u \). For easy comparison, the true solution \( u(t) = e^t \) is also shown (blue continuous line). <div id="fig:FEgeom"></div> </p></center>
<p><img src="figs/fE_geom_sol.png" align="bottom" width=800></p>
</center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>ForwardEuler_geometric_solution.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:FE:test1">Exercise 45: Make test functions for the Forward Euler method</h2>

<p>
The purpose of this exercise is to
make a file <code>test_ode_FE.py</code> that makes use of the <code>ode_FE</code>
function in the file <code>ode_FE.py</code> and automatically verifies the
implementation of <code>ode_FE</code>.

<p>
<b>a)</b>
The solution computed by hand in <a href="#sec:de:exer:geom">Exercise 44: Geometric construction of the Forward Euler method</a> can be
used as a reference solution. Make a function <code>test_ode_FE_1()</code>
that calls <code>ode_FE</code> to compute
three time steps in the problem \( u'=u \), \( u(0)=1 \), and compare the
three values \( u^1 \), \( u^2 \), and \( u^3 \) with the values obtained in
<a href="#sec:de:exer:geom">Exercise 44: Geometric construction of the Forward Euler method</a>.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_45_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_45_1">

<p>
See code presented below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
The test in a) can be made more general using the fact
that if \( f \) is linear in \( u \) and does not depend on \( t \), i.e., we
have \( u'=ru \), for
some constant \( r \), the Forward Euler method has a closed form solution
as outlined in the section <a href="._p4c-bootstrap-Python020.html#sec:de:pg:model">Derivation of the model</a>: \( u^n=U_0(1+r\Delta t)^n \).
Use this result to construct a test function <code>test_ode_FE_2()</code> that
runs a number of steps in <code>ode_FE</code> and compares the computed
solution with the listed formula for \( u^n \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_45_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_45_2">

<p>
The code may be written as:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">ode_FE</span> <span style="color: #008000; font-weight: bold">import</span> ode_FE

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_ode_FE_1</span>():
    hand <span style="color: #666666">=</span> [<span style="color: #666666">1.0</span>, <span style="color: #666666">2.0</span>, <span style="color: #666666">4.0</span>, <span style="color: #666666">8.0</span>]
    T <span style="color: #666666">=</span> <span style="color: #666666">3.0</span>
    dt <span style="color: #666666">=</span> <span style="color: #666666">1.0</span>
    U_0 <span style="color: #666666">=</span> <span style="color: #666666">1.0</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(u, t):
        <span style="color: #008000; font-weight: bold">return</span> u
        
    u, t <span style="color: #666666">=</span> ode_FE(f, U_0, dt, T)
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-14</span>
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(hand)):
        err <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(hand[i] <span style="color: #666666">-</span> u[i]) 
        <span style="color: #008000; font-weight: bold">assert</span> err <span style="color: #666666">&lt;</span> tol, <span style="color: #BA2121">&#39;i=</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">, err=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (i, err)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_ode_FE_2</span>():
    T <span style="color: #666666">=</span> <span style="color: #666666">3.0</span>
    dt <span style="color: #666666">=</span> <span style="color: #666666">0.1</span>       <span style="color: #408080; font-style: italic"># Tested first dt = 1.0, ok</span>
    U_0 <span style="color: #666666">=</span> <span style="color: #666666">1.0</span>   
    r <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(u,t):
        <span style="color: #008000; font-weight: bold">return</span> r<span style="color: #666666">*</span>u
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">u_exact</span>(U_0, r, dt, n):
        <span style="color: #008000; font-weight: bold">return</span> U_0<span style="color: #666666">*</span>(<span style="color: #666666">1+</span>r<span style="color: #666666">*</span>dt)<span style="color: #666666">**</span>n
    u, t <span style="color: #666666">=</span> ode_FE(f, U_0, dt, T)
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-12</span>    <span style="color: #408080; font-style: italic"># Relaxed from 1E-14 to get through</span>
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(u)):
        err <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(u_exact(U_0, r, dt, n) <span style="color: #666666">-</span> u[n]) 
        <span style="color: #008000; font-weight: bold">assert</span> err <span style="color: #666666">&lt;</span> tol, <span style="color: #BA2121">&#39;n=</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">, err=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (n, err)
    
test_ode_FE_1()
test_ode_FE_2()
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>test_ode_FE.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:Heun:pg">Exercise 46: Implement and evaluate Heun's method</h2>

<p>
<b>a)</b>
A 2nd-order Runge-Kutta method, also known has Heun's method,
is derived in the section <a href="._p4c-bootstrap-Python022.html#sec:de:osc:Heun">The 2nd-order Runge-Kutta method (or Heun's method)</a>. Make a function
<code>ode_Heun(f, U_0, dt, T)</code> (as a counterpart to <code>ode_FE(f, U_0, dt, T)</code>
in <code>ode_FE.py</code>) for solving  a scalar ODE problem \( u'=f(u,t) \),
\( u(0)=U_0 \), \( t\in (0,T] \), with
this method using a time step size \( \Delta t \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_46_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_46_1">

<p>
See code below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Solve the simple ODE problem \( u'=u \), \( u(0)=1 \), by the <code>ode_Heun</code> and
the <code>ode_FE</code> function. Make
a plot that compares Heun's method and the Forward Euler method
with the exact solution \( u(t)=e^t \) for \( t\in [0,6] \). Use a
time step \( \Delta t = 0.5 \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_46_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_46_2">

<p>
The function <code>ode_Heun</code> was implemented together with the demo function
<code>demo_ode_Heun</code> (dedicated to the solving of the given ODE):

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> linspace, zeros, exp
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">ode_FE</span> <span style="color: #008000; font-weight: bold">import</span> ode_FE

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">ode_Heun</span>(f, U_0, dt, T):
    N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(<span style="color: #008000">float</span>(T)<span style="color: #666666">/</span>dt))
    u <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
    t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, <span style="color: #008000">len</span>(u))
    u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> U_0
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
        u_star <span style="color: #666666">=</span> u[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>f(u[n],t[n])
        u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> u[n] <span style="color: #666666">+</span> <span style="color: #666666">0.5*</span>dt<span style="color: #666666">*</span>(f(u[n],t[n]) <span style="color: #666666">+</span> f(u_star,t[n]))
    <span style="color: #008000; font-weight: bold">return</span> u, t
    
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">demo_ode_Heun</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Test case: u&#39; = u, u(0) = 1&quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(u,t):
        <span style="color: #008000; font-weight: bold">return</span> u
    
    u_Heun, t <span style="color: #666666">=</span> ode_Heun(f<span style="color: #666666">=</span>f, U_0<span style="color: #666666">=1</span>, dt<span style="color: #666666">=0.5</span>, T<span style="color: #666666">=6</span>)
    u_FE, t   <span style="color: #666666">=</span> ode_FE(f<span style="color: #666666">=</span>f, U_0<span style="color: #666666">=1</span>, dt<span style="color: #666666">=0.5</span>, T<span style="color: #666666">=6</span>)
    fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
    l1, l2, l3 <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>plot(<span style="color: #666666">...</span>
                t, u_Heun,<span style="color: #BA2121">&#39;b-&#39;</span>, t, u_FE,<span style="color: #BA2121">&#39;b--&#39;</span>, t, exp(t),<span style="color: #BA2121">&#39;r--&#39;</span>)
    fig<span style="color: #666666">.</span>legend((l1, l2, l3), (<span style="color: #BA2121">&#39;H&#39;</span>, <span style="color: #BA2121">&#39;FE&#39;</span>, <span style="color: #BA2121">&#39;true&#39;</span>), <span style="color: #BA2121">&#39;upper left&#39;</span>)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
    plt<span style="color: #666666">.</span>show()

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    demo_ode_Heun()
</pre></div>
<p>
Running the code with \( \Delta t = 0.5 \) (seen in the code) gives the plot seen in Figure <a href="#H_FE_comp">52</a>.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 52:  Heun and Forward Euler with timestep \( \Delta t = 0.5 \). <div id="H_FE_comp"></div> </p></center>
<p><img src="figs/H_FE_comp.png" align="bottom" width=800></p>
</center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>c)</b>
For the case in b),
find through experimentation the largest value of \( \Delta t \) where the
exact solution and the numerical solution by Heun's method
cannot be distinguished visually. It is of interest to see how far
off the curve the Forward Euler method is when Heun's method can
be regarded as &quot;exact&quot; (for visual purposes).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_46_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_46_3">

<p>
A timestep of \( \Delta t = 0.1 \) was found to be the largest reasonable timestep
that still made the solution from Heun's method come on top of the exact solution
(from graphical inspection only), see Figure <a href="#H_exact_FE_comp">53</a>.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 53:  Heun and Forward Euler with timestep \( \Delta t = 0.1 \). A larger timestep makes Heun's method deviate from the true solution (only judged graphically). <div id="H_exact_FE_comp"></div> </p></center>
<p><img src="figs/H_exact_FE_comp.png" align="bottom" width=800></p>
</center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>ode_Heun.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:logistic:dtopt">Exercise 47: Find an appropriate time step; logistic model</h2>

<p>
Compute the numerical solution of the logistic equation for a set of
repeatedly halved time steps: \( \Delta t_k = 2^{-k}\Delta t \),
\( k=0,1,\ldots \).  Plot the solutions corresponding to the last two time
steps \( \Delta t_{k} \) and \( \Delta t_{k-1} \) in the same plot.  Continue
doing this until you cannot visually distinguish the two curves in the
plot. Then one has found a sufficiently small time step.

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_47_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_47_1">

<p>
Extend the <code>logistic.py</code> file. Introduce a loop over \( k \), write out
\( \Delta t_k \), and ask the
user if the loop is to be continued.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_47_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_47_2">

<p>
This may be implemented as:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">ode_FE</span> <span style="color: #008000; font-weight: bold">import</span> ode_FE
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

dt <span style="color: #666666">=</span> <span style="color: #666666">20</span>; T <span style="color: #666666">=</span> <span style="color: #666666">100</span>
u_old, t_old <span style="color: #666666">=</span> ode_FE(f<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> u, t: <span style="color: #666666">0.1*</span>(<span style="color: #666666">1-</span>u<span style="color: #666666">/500.</span>)<span style="color: #666666">*</span>u,
                      U_0<span style="color: #666666">=100</span>, dt<span style="color: #666666">=</span>dt, T<span style="color: #666666">=</span>T)
k <span style="color: #666666">=</span> <span style="color: #666666">1</span>
one_more <span style="color: #666666">=</span> <span style="color: #008000">True</span>
<span style="color: #008000; font-weight: bold">while</span> one_more <span style="color: #666666">==</span> <span style="color: #008000">True</span>:
    dt_k <span style="color: #666666">=</span> <span style="color: #666666">2**</span>(<span style="color: #666666">-</span>k)<span style="color: #666666">*</span>dt
    u_new, t_new <span style="color: #666666">=</span> ode_FE(f<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> u, t: <span style="color: #666666">0.1*</span>(<span style="color: #666666">1-</span>u<span style="color: #666666">/500.</span>)<span style="color: #666666">*</span>u,
                  U_0<span style="color: #666666">=100</span>, dt<span style="color: #666666">=</span>dt_k, T<span style="color: #666666">=</span>T)
    plt<span style="color: #666666">.</span>plot(t_old,u_old,<span style="color: #BA2121">&#39;b-&#39;</span>,t_new,u_new,<span style="color: #BA2121">&#39;r--&#39;</span>)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>); plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;N(t)&#39;</span>);
    plt<span style="color: #666666">.</span>show()
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&quot;Timestep was: &quot;</span>, dt_k
    answer <span style="color: #666666">=</span> <span style="color: #008000">raw_input</span>(<span style="color: #BA2121">&#39;Do one more with finer dt (y/n)? &#39;</span>)
    <span style="color: #008000; font-weight: bold">if</span> answer <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;y&#39;</span>:
        u_old <span style="color: #666666">=</span> u_new<span style="color: #666666">.</span>copy()
        t_old <span style="color: #666666">=</span> t_new<span style="color: #666666">.</span>copy()
    <span style="color: #008000; font-weight: bold">else</span>:
        one_more <span style="color: #666666">=</span> <span style="color: #008000">False</span>
    k <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>logistic_dt.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:SIR:dtopt">Exercise 48: Find an appropriate time step; SIR model</h2>

<p>
Repeat <a href="#sec:de:exer:logistic:dtopt">Exercise 47: Find an appropriate time step; logistic model</a> for the SIR model.

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_48_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_48_1">

<p>
Import the <code>ode_FE</code> function from the <code>ode_system_FE</code> module
and make a modified <code>demo_SIR</code> function that has a loop
over repeatedly halved time steps. Plot \( S \), \( I \), and \( R \)
versus time for the two last time step sizes in the same plot.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_48_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_48_2">

<p>
This may be implemented as:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">ode_system_FE</span> <span style="color: #008000; font-weight: bold">import</span> ode_FE
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">demo_SIR</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Test case using an SIR model&quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(u, t):
        S, I, R <span style="color: #666666">=</span> u
        <span style="color: #008000; font-weight: bold">return</span> [<span style="color: #666666">-</span>beta<span style="color: #666666">*</span>S<span style="color: #666666">*</span>I, beta<span style="color: #666666">*</span>S<span style="color: #666666">*</span>I <span style="color: #666666">-</span> gamma<span style="color: #666666">*</span>I, gamma<span style="color: #666666">*</span>I]
        
    beta <span style="color: #666666">=</span> <span style="color: #666666">10./</span>(<span style="color: #666666">40*8*24</span>)
    gamma <span style="color: #666666">=</span> <span style="color: #666666">3./</span>(<span style="color: #666666">15*24</span>)
    dt <span style="color: #666666">=</span> <span style="color: #666666">48.0</span>           <span style="color: #408080; font-style: italic"># 48 h</span>
    D <span style="color: #666666">=</span> <span style="color: #666666">30</span>              <span style="color: #408080; font-style: italic"># Simulate for D days</span>
    N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(D<span style="color: #666666">*24/</span>dt)  <span style="color: #408080; font-style: italic"># Corresponding no of hours</span>
    T <span style="color: #666666">=</span> dt<span style="color: #666666">*</span>N_t          <span style="color: #408080; font-style: italic"># End time</span>
    U_0 <span style="color: #666666">=</span> [<span style="color: #666666">50</span>, <span style="color: #666666">1</span>, <span style="color: #666666">0</span>]
    
    u_old, t_old <span style="color: #666666">=</span> ode_FE(f, U_0, dt, T)
    S_old <span style="color: #666666">=</span> u_old[:,<span style="color: #666666">0</span>]
    I_old <span style="color: #666666">=</span> u_old[:,<span style="color: #666666">1</span>]
    R_old <span style="color: #666666">=</span> u_old[:,<span style="color: #666666">2</span>]
    
    k <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    one_more <span style="color: #666666">=</span> <span style="color: #008000">True</span>
    <span style="color: #008000; font-weight: bold">while</span> one_more <span style="color: #666666">==</span> <span style="color: #008000">True</span>:
        dt_k <span style="color: #666666">=</span> <span style="color: #666666">2**</span>(<span style="color: #666666">-</span>k)<span style="color: #666666">*</span>dt
        u_new, t_new <span style="color: #666666">=</span> ode_FE(f, U_0, dt_k, T)
        S_new <span style="color: #666666">=</span> u_new[:,<span style="color: #666666">0</span>]
        I_new <span style="color: #666666">=</span> u_new[:,<span style="color: #666666">1</span>]
        R_new <span style="color: #666666">=</span> u_new[:,<span style="color: #666666">2</span>]

        plt<span style="color: #666666">.</span>plot(t_old, S_old, <span style="color: #BA2121">&#39;b-&#39;</span>, t_new, S_new, <span style="color: #BA2121">&#39;b--&#39;</span>,\
                 t_old, I_old, <span style="color: #BA2121">&#39;r-&#39;</span>, t_new, I_new, <span style="color: #BA2121">&#39;r--&#39;</span>,\
                 t_old, R_old, <span style="color: #BA2121">&#39;g-&#39;</span>, t_new, R_new, <span style="color: #BA2121">&#39;g--&#39;</span>)
        plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;hours&#39;</span>); 
        plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;S (blue), I (red), R (green)&#39;</span>)
        plt<span style="color: #666666">.</span>show()
        
        <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&quot;Finest timestep was: &quot;</span>, dt_k
        answer <span style="color: #666666">=</span> <span style="color: #008000">raw_input</span>(<span style="color: #BA2121">&#39;Do one more with finer dt (y/n)? &#39;</span>)
        <span style="color: #008000; font-weight: bold">if</span> answer <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;y&#39;</span>:
            S_old <span style="color: #666666">=</span> S_new<span style="color: #666666">.</span>copy()
            R_old <span style="color: #666666">=</span> R_new<span style="color: #666666">.</span>copy()
            I_old <span style="color: #666666">=</span> I_new<span style="color: #666666">.</span>copy()
            t_old <span style="color: #666666">=</span> t_new<span style="color: #666666">.</span>copy()
            k <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
        <span style="color: #008000; font-weight: bold">else</span>:
            one_more <span style="color: #666666">=</span> <span style="color: #008000">False</span>
            
<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    demo_SIR()
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>SIR_dt.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:SIRV:padapt">Exercise 49: Model an adaptive vaccination campaign</h2>

<p>
In the SIRV model with time-dependent vaccination from
the section <a href="._p4c-bootstrap-Python021.html#sec:de:flu:vaccine:discont">Discontinuous coefficients: a vaccination campaign</a>, we want to test the effect
of an adaptive vaccination campaign where vaccination is offered as
long as half of the population is not vaccinated. The campaign starts
after \( \Delta \) days. That is,
\( p=p_0 \) if \( V < \frac{1}{2}(S^0+I^0) \) and \( t>\Delta \) days,
otherwise \( p=0 \).

<p>
Demonstrate the effect of this vaccination policy: choose \( \beta \),
\( \gamma \), and \( \nu \) as in the section <a href="._p4c-bootstrap-Python021.html#sec:de:flu:vaccine:discont">Discontinuous coefficients: a vaccination campaign</a>,
set \( p=0.001 \), \( \Delta =10 \) days, and simulate for 200 days.

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_49_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_49_1">

<p>
This discontinuous \( p(t) \) function is easiest implemented as a
Python function containing the indicated <code>if</code> test.
You may use the file <code>SIRV1.py</code>
as starting point, but note that it implements a time-dependent
\( p(t) \) via an array.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_49_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_49_2">

<p>
An appropriate program is

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># Time unit: 1 h</span>
beta <span style="color: #666666">=</span> <span style="color: #666666">10./</span>(<span style="color: #666666">40*8*24</span>)
beta <span style="color: #666666">/=</span> <span style="color: #666666">4</span>            <span style="color: #408080; font-style: italic"># reduce beta compared to SIR1.py</span>
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;beta:&#39;</span>, beta
gamma <span style="color: #666666">=</span> <span style="color: #666666">3./</span>(<span style="color: #666666">15*24</span>)
dt <span style="color: #666666">=</span> <span style="color: #666666">0.1</span>             <span style="color: #408080; font-style: italic"># 6 min</span>
D <span style="color: #666666">=</span> <span style="color: #666666">200</span>              <span style="color: #408080; font-style: italic"># simulate for D days</span>
N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(D<span style="color: #666666">*24/</span>dt)   <span style="color: #408080; font-style: italic"># corresponding no of hours</span>
nu <span style="color: #666666">=</span> <span style="color: #666666">1./</span>(<span style="color: #666666">24*50</span>)      <span style="color: #408080; font-style: italic"># average loss of immunity</span>
Delta <span style="color: #666666">=</span> <span style="color: #666666">10</span>           <span style="color: #408080; font-style: italic"># start point of campaign (in days)</span>
p_0 <span style="color: #666666">=</span> <span style="color: #666666">0.001</span>

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace
t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, N_t<span style="color: #666666">+1</span>)
S <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
I <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
R <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
V <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">p</span>(t):
    <span style="color: #408080; font-style: italic"># Rely on p_0, n, S, and V as global variables</span>
    <span style="color: #008000; font-weight: bold">return</span> p_0 <span style="color: #008000; font-weight: bold">if</span> (V[n] <span style="color: #666666">&lt;</span> <span style="color: #666666">0.5*</span>(S[<span style="color: #666666">0</span>]<span style="color: #666666">+</span>I[<span style="color: #666666">0</span>]) <span style="color: #AA22FF; font-weight: bold">and</span> t <span style="color: #666666">&gt;</span> Delta<span style="color: #666666">*24</span>) <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">0</span>

<span style="color: #408080; font-style: italic"># Initial condition</span>
S[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">50</span>
I[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>
R[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
V[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

<span style="color: #408080; font-style: italic"># Step equations forward in time</span>
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
    S[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> S[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S[n]<span style="color: #666666">*</span>I[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>nu<span style="color: #666666">*</span>R[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>p(t[n])<span style="color: #666666">*</span>S[n]
    V[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> V[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>p(t[n])<span style="color: #666666">*</span>S[n]
    I[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> I[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S[n]<span style="color: #666666">*</span>I[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I[n]
    R[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> R[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>nu<span style="color: #666666">*</span>R[n]
    loss <span style="color: #666666">=</span> <span style="color: #008000">int</span>(V[n<span style="color: #666666">+1</span>] <span style="color: #666666">+</span> S[n<span style="color: #666666">+1</span>] <span style="color: #666666">+</span> R[n<span style="color: #666666">+1</span>] <span style="color: #666666">+</span> I[n<span style="color: #666666">+1</span>]) <span style="color: #666666">-</span> \ 
           <span style="color: #008000">int</span>(V[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> S[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> R[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> I[<span style="color: #666666">0</span>])
    <span style="color: #008000; font-weight: bold">if</span> loss <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
        <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;loss: </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> loss

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">import</span> plot, savefig, legend, xlabel, show
plot(t, S, t, I, t, R, t, V)
legend([<span style="color: #BA2121">&#39;S&#39;</span>, <span style="color: #BA2121">&#39;I&#39;</span>, <span style="color: #BA2121">&#39;R&#39;</span>, <span style="color: #BA2121">&#39;V&#39;</span>], loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;upper right&#39;</span>)
xlabel(<span style="color: #BA2121">&#39;hours&#39;</span>)
savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>); savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>)
show()
</pre></div>
<p>
The result looks like

<p>
<center><p><img src="figs/SIRV_p_adapt.png" align="bottom" width=600></p></center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>SIRV_p_adapt.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:SIRV:padapt_time_limited">Exercise 50: Make a SIRV model with time-limited effect of vaccination</h2>

<p>
We consider the SIRV model from
the section <a href="._p4c-bootstrap-Python021.html#sec:de:flu:vaccine">Incorporating vaccination</a>, but now the effect of vaccination is
time-limited. After a characteristic period of time, \( \pi \), the
vaccination is no more effective and individuals are
consequently moved from the V
to the S category and can be infected again. Mathematically, this
can be modeled as an average leakage \( -\pi^{-1}V \) from the V category to the S
category (i.e., a gain \( \pi^{-1}V \) in the latter). Write up the
complete model, implement it, and rerun the case from
the section <a href="._p4c-bootstrap-Python021.html#sec:de:flu:vaccine">Incorporating vaccination</a> with various choices of parameters to
illustrate various effects.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_50_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_50_1">

<p>
A possible code is

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;As SIR2.py, but including constant vaccination.&quot;&quot;&quot;</span>

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #408080; font-style: italic"># Time unit: 1 h</span>
beta <span style="color: #666666">=</span> <span style="color: #666666">10./</span>(<span style="color: #666666">40*8*24</span>)
beta <span style="color: #666666">/=</span> <span style="color: #666666">4</span>            <span style="color: #408080; font-style: italic"># reduce beta compared to SIR1.py</span>
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;beta:&#39;</span>, beta
gamma <span style="color: #666666">=</span> <span style="color: #666666">3./</span>(<span style="color: #666666">15*24</span>)
dt <span style="color: #666666">=</span> <span style="color: #666666">0.1</span>             <span style="color: #408080; font-style: italic"># 6 min</span>
D <span style="color: #666666">=</span> <span style="color: #666666">300</span>              <span style="color: #408080; font-style: italic"># Simulate for D days</span>
N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(D<span style="color: #666666">*24/</span>dt)   <span style="color: #408080; font-style: italic"># Corresponding no of hours</span>
nu <span style="color: #666666">=</span> <span style="color: #666666">1./</span>(<span style="color: #666666">24*50</span>)      <span style="color: #408080; font-style: italic"># Average loss of immunity: 50 days</span>
p <span style="color: #666666">=</span> <span style="color: #666666">0.01</span>             <span style="color: #408080; font-style: italic"># Effect of vaccination</span>
pi <span style="color: #666666">=</span> <span style="color: #666666">1./50</span>           <span style="color: #408080; font-style: italic"># Average loss of vaccine effect: 50 days</span>

t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, N_t<span style="color: #666666">+1</span>)
S <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
I <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
R <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
V <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)

<span style="color: #408080; font-style: italic"># Initial condition</span>
S[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">50</span>
I[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>
R[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
V[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

<span style="color: #408080; font-style: italic"># Step equations forward in time</span>
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
    S[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> S[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S[n]<span style="color: #666666">*</span>I[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>nu<span style="color: #666666">*</span>R[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>p<span style="color: #666666">*</span>S[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>pi<span style="color: #666666">*</span>V[n]
    V[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> V[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>p<span style="color: #666666">*</span>S[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>pi<span style="color: #666666">*</span>V[n]
    I[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> I[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S[n]<span style="color: #666666">*</span>I[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I[n]
    R[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> R[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>nu<span style="color: #666666">*</span>R[n]
    loss <span style="color: #666666">=</span> <span style="color: #008000">int</span>(V[n<span style="color: #666666">+1</span>] <span style="color: #666666">+</span> S[n<span style="color: #666666">+1</span>] <span style="color: #666666">+</span> R[n<span style="color: #666666">+1</span>] <span style="color: #666666">+</span> I[n<span style="color: #666666">+1</span>]) <span style="color: #666666">-</span> \
           <span style="color: #008000">int</span>(V[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> S[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> R[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> I[<span style="color: #666666">0</span>])
    <span style="color: #008000; font-weight: bold">if</span> loss <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
        <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;loss: </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> loss

fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
t <span style="color: #666666">/=</span> <span style="color: #666666">24.0</span>  <span style="color: #408080; font-style: italic"># convert hours to days in plots</span>
l1, l2, l3, l4 <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>plot(t, S, t, I, t, R, t, V)
fig<span style="color: #666666">.</span>legend((l1, l2, l3, l4), (<span style="color: #BA2121">&#39;S&#39;</span>, <span style="color: #BA2121">&#39;I&#39;</span>, <span style="color: #BA2121">&#39;R&#39;</span>, <span style="color: #BA2121">&#39;V&#39;</span>), <span style="color: #BA2121">&#39;upper right&#39;</span>)
plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;days&#39;</span>)
plt<span style="color: #666666">.</span>show()
plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>); plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>)
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>SIRV1_V2S.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:vib:FE:func">Exercise 51: Refactor a flat program</h2>

<p>
Consider the file <code>osc_FE.py</code> implementing the Forward Euler
method for the oscillating system model
<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.43">(4.43)</a>-<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.44">(4.44)</a>.
The <code>osc_FE.py</code> is what we often refer to as a flat program,
meaning that it is just one main program with no functions.
To easily reuse the numerical computations in other contexts,
place the part that produces the numerical solution (allocation of arrays,
initializing the arrays at time zero, and the time loop) in
a function <code>osc_FE(X_0, omega, dt, T)</code>, which returns <code>u, v, t</code>.
Place the particular
computational example in <code>osc_FE.py</code> in a function
<code>demo()</code>.
Construct the file <code>osc_FE_func.py</code> such that the
<code>osc_FE</code> function can easily be reused
in other programs.
In Python, this means that <code>osc_FE_func.py</code> is a module that can
be imported in other programs.
The requirement of a module is that there should be no main program,
except in the test block.
You must therefore
call <code>demo</code> from a test block (i.e., the block
after <code>if __name__ == '__main__'</code>).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_51_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_51_1">

<p>
Here is the file
<code>osc_FE_func.py</code>:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace, pi, cos

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">osc_FE</span>(X_0, omega, dt, T):
    N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
    u <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
    v <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
    t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, N_t<span style="color: #666666">+1</span>)

    <span style="color: #408080; font-style: italic"># Initial condition</span>
    u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> X_0
    v[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

    <span style="color: #408080; font-style: italic"># Step equations forward in time</span>
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
        u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> u[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>v[n]
        v[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> v[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>omega<span style="color: #666666">**2*</span>u[n]
    <span style="color: #008000; font-weight: bold">return</span> u, v, t

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">demo</span>():
    omega <span style="color: #666666">=</span> <span style="color: #666666">2</span>
    P <span style="color: #666666">=</span> <span style="color: #666666">2*</span>pi<span style="color: #666666">/</span>omega
    dt <span style="color: #666666">=</span> P<span style="color: #666666">/20</span>
    T <span style="color: #666666">=</span> <span style="color: #666666">3*</span>P
    X_0 <span style="color: #666666">=</span> <span style="color: #666666">2</span>
    u, v, t <span style="color: #666666">=</span> osc_Heun(X_0, omega, dt, T)

    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">import</span> \ 
        plot, savefig, legend, xlabel, figure, show
    plot(t, u, <span style="color: #BA2121">&#39;b-&#39;</span>, t, X_0<span style="color: #666666">*</span>cos(omega<span style="color: #666666">*</span>t), <span style="color: #BA2121">&#39;r--&#39;</span>)
    legend([<span style="color: #BA2121">&#39;numerical&#39;</span>, <span style="color: #BA2121">&#39;exact&#39;</span>], loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;upper left&#39;</span>)
    xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
    savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>); savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>)

    <span style="color: #408080; font-style: italic"># Exact analytical solution</span>
    figure()
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> array
    u_num_ex <span style="color: #666666">=</span> array([X_0<span style="color: #666666">*</span>(<span style="color: #666666">1+1j*</span>omega<span style="color: #666666">*</span>dt)<span style="color: #666666">**</span>n <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t<span style="color: #666666">+1</span>)])
    plot(t, u, <span style="color: #BA2121">&#39;b-&#39;</span>, t, u_num_ex<span style="color: #666666">.</span>real, <span style="color: #BA2121">&#39;r-&#39;</span>)
    show()

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    demo()
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>osc_FE_func.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:vib:ode_FE">Exercise 52: Simulate oscillations by a general ODE solver</h2>

<p>
Solve the system <a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.43">(4.43)</a>-<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.44">(4.44)</a>
using the general solver <code>ode_FE</code> in the file <code>ode_system_FE.py</code>
described in the section <a href="._p4c-bootstrap-Python021.html#sec:de:flu:prog:generic">Programming the numerical method; the general case</a>. Program the ODE system
and the call to the <code>ode_FE</code> function in a separate file
<code>osc_ode_FE.py</code>.

<p>
Equip this file with a test function that reads a file with correct
\( u \) values and compares these with those computed by the <code>ode_FE</code>
function. To find correct \( u \) values, modify the program
<code>osc_FE.py</code> to dump the <code>u</code> array to file, run <code>osc_FE.py</code>, and
let the test function read the reference results from that file.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_52_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_52_1">

<p>
The program may be implemented as:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">ode_system_FE</span> <span style="color: #008000; font-weight: bold">import</span> ode_FE
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">osc_FE_2file</span>(filename, X_0, omega, dt, T):
    N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(<span style="color: #008000">float</span>(T<span style="color: #666666">/</span>dt)))
    u <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
    v <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)

    <span style="color: #408080; font-style: italic"># Initial condition</span>
    u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> X_0
    v[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    
    outfile <span style="color: #666666">=</span> <span style="color: #008000">open</span>(filename, <span style="color: #BA2121">&#39;w&#39;</span>)  
    outfile<span style="color: #666666">.</span>write(<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%10.5f</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (u[<span style="color: #666666">0</span>]))

    <span style="color: #408080; font-style: italic"># Step equations forward in time</span>
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
        u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> u[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>v[n]
        v[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> v[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>omega<span style="color: #666666">**2*</span>u[n]  
        outfile<span style="color: #666666">.</span>write(<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%10.5f</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (u[n<span style="color: #666666">+1</span>]))
    outfile<span style="color: #666666">.</span>close()   

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_osc_ode_FE</span>():
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(sol, t, omega<span style="color: #666666">=2</span>):
        u, v <span style="color: #666666">=</span> sol
        <span style="color: #008000; font-weight: bold">return</span> [v, <span style="color: #666666">-</span>omega<span style="color: #666666">**2*</span>u]
    
    <span style="color: #408080; font-style: italic"># Set and compute problem dependent parameters</span>
    omega <span style="color: #666666">=</span> <span style="color: #666666">2</span>
    X_0 <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    number_of_periods <span style="color: #666666">=</span> <span style="color: #666666">6</span>
    time_intervals_per_period <span style="color: #666666">=</span> <span style="color: #666666">20</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> pi
    P <span style="color: #666666">=</span> <span style="color: #666666">2*</span>pi<span style="color: #666666">/</span>omega                      <span style="color: #408080; font-style: italic"># Length of one period</span>
    dt <span style="color: #666666">=</span> P<span style="color: #666666">/</span>time_intervals_per_period    <span style="color: #408080; font-style: italic"># Time step       </span>
    T <span style="color: #666666">=</span> number_of_periods<span style="color: #666666">*</span>P             <span style="color: #408080; font-style: italic"># Final simulation time</span>
    U_0 <span style="color: #666666">=</span> [X_0, <span style="color: #666666">0</span>]                      <span style="color: #408080; font-style: italic"># Initial conditions</span>
    
    <span style="color: #408080; font-style: italic"># Produce u data on file that will be used for reference</span>
    file_name <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;osc_FE_data&#39;</span>
    osc_FE_2file(file_name, X_0, omega, dt, T)    
    
    sol, t <span style="color: #666666">=</span> ode_FE(f, U_0, dt, T)
    u <span style="color: #666666">=</span> sol[:,<span style="color: #666666">0</span>]
       
    <span style="color: #408080; font-style: italic"># Read data from file for comparison       </span>
    infile <span style="color: #666666">=</span> <span style="color: #008000">open</span>(file_name, <span style="color: #BA2121">&#39;r&#39;</span>)
    u_ref <span style="color: #666666">=</span> [];  
    <span style="color: #008000; font-weight: bold">for</span> line <span style="color: #AA22FF; font-weight: bold">in</span> infile:
        words <span style="color: #666666">=</span> line<span style="color: #666666">.</span>split()
        u_ref<span style="color: #666666">.</span>append(<span style="color: #008000">float</span>(words[<span style="color: #666666">0</span>]))
    infile<span style="color: #666666">.</span>close()
     
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-5</span>               <span style="color: #408080; font-style: italic"># Tried several stricter ones first</span>
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(u)):
        err <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(u_ref[n] <span style="color: #666666">-</span> u[n])
        success <span style="color: #666666">=</span> err <span style="color: #666666">&lt;</span> tol
        msg <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;n=</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">, err=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (n, err)
        <span style="color: #008000; font-weight: bold">assert</span> success, msg
    
    <span style="color: #408080; font-style: italic"># choose to also plot, just to get a visual impression of u</span>
    fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
    l1, l2 <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>plot(t, u_ref, <span style="color: #BA2121">&#39;b-&#39;</span>, t, u, <span style="color: #BA2121">&#39;r--&#39;</span>)
    fig<span style="color: #666666">.</span>legend((l1, l2), (<span style="color: #BA2121">&#39;u ref&#39;</span>,<span style="color: #BA2121">&#39;u&#39;</span>), <span style="color: #BA2121">&#39;upper left&#39;</span>)
    plt<span style="color: #666666">.</span>show()
    
<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    test_osc_ode_FE()
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>osc_ode_FE.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:vib:energy">Exercise 53: Compute the energy in oscillations</h2>

<p>
<b>a)</b>
Make a function <code>osc_energy(u, v, omega)</code> for returning the potential and
kinetic energy of an oscillating system described by
<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.43">(4.43)</a>-<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.44">(4.44)</a>.
The potential energy is taken as \( \frac{1}{2}\omega^2u^2 \) while
the kinetic energy is \( \frac{1}{2}v^2 \). (Note that these expressions
are not exactly the <em>physical</em> potential and kinetic energy, since
these would be \( \frac{1}{2}mv^2 \) and \( \frac{1}{2}ku^2 \) for a model
\( mx'' + kx=0 \).)

<p>
Place the <code>osc_energy</code> in a separate file <code>osc_energy.py</code>
such that the function can be called from other functions.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_53_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_53_1">

<p>
The function may be implemented as:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">osc_energy</span>(u, v, omega):
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0.5*</span>omega<span style="color: #666666">**2*</span>u<span style="color: #666666">**2</span>, <span style="color: #666666">0.5*</span>v<span style="color: #666666">**2</span>
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Add a call to <code>osc_energy</code> in the programs <code>osc_FE.py</code> and
<code>osc_EC.py</code> and plot the <em>sum</em> of the kinetic and potential energy.
How does the total energy develop for the Forward Euler and the
Euler-Cromer schemes?

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_53_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_53_2">

<p>
The Forward Euler code reads

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">osc_energy</span> <span style="color: #008000; font-weight: bold">import</span> osc_energy
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace, pi, cos

omega <span style="color: #666666">=</span> <span style="color: #666666">2</span>
P <span style="color: #666666">=</span> <span style="color: #666666">2*</span>pi<span style="color: #666666">/</span>omega
dt <span style="color: #666666">=</span> P<span style="color: #666666">/20</span>
T <span style="color: #666666">=</span> <span style="color: #666666">3*</span>P
N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, N_t<span style="color: #666666">+1</span>)

u <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
v <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)

<span style="color: #408080; font-style: italic"># Initial condition</span>
X_0 <span style="color: #666666">=</span> <span style="color: #666666">2</span>
u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> X_0
v[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

<span style="color: #408080; font-style: italic"># Step equations forward in time</span>
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
    u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> u[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>v[n]
    v[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> v[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>omega<span style="color: #666666">**2*</span>u[n]

U, K <span style="color: #666666">=</span> osc_energy(u, v, omega)

plt<span style="color: #666666">.</span>plot(t, U<span style="color: #666666">+</span>K, <span style="color: #BA2121">&#39;b-&#39;</span>)
plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;U+K&#39;</span>)
plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
The program generates the following plot showing how the energy increases with time.

<p>
<center><p><img src="figs/osc_FE_energy.png" align="bottom" width=600></p></center>

<p>
The Euler-Cromer code might be implemented as

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">osc_energy</span> <span style="color: #008000; font-weight: bold">import</span> osc_energy
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace, pi, cos
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

omega <span style="color: #666666">=</span> <span style="color: #666666">2</span>
P <span style="color: #666666">=</span> <span style="color: #666666">2*</span>pi<span style="color: #666666">/</span>omega
dt <span style="color: #666666">=</span> P<span style="color: #666666">/20</span>
T <span style="color: #666666">=</span> <span style="color: #666666">40*</span>P
N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, N_t<span style="color: #666666">+1</span>)
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;N_t:&#39;</span>, N_t

u <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
v <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)

<span style="color: #408080; font-style: italic"># Initial condition</span>
X_0 <span style="color: #666666">=</span> <span style="color: #666666">2</span>
u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> X_0
v[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

<span style="color: #408080; font-style: italic"># Step equations forward in time</span>
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
    v[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> v[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>omega<span style="color: #666666">**2*</span>u[n]
    u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> u[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>v[n<span style="color: #666666">+1</span>]

U, K <span style="color: #666666">=</span> osc_energy(u, v, omega)
plt<span style="color: #666666">.</span>plot(t, U<span style="color: #666666">+</span>K, <span style="color: #BA2121">&#39;b-&#39;</span>)
plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;U+K&#39;</span>)
plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
In this case, as illustrated by the plot produced, the energy does not increase.

<p>
<center><p><img src="figs/osc_EC_energy.png" align="bottom" width=600></p></center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filenames: <code>osc_energy.py</code>, <code>osc_FE_energy.py</code>, <code>osc_EC_energy.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:pg:BE">Exercise 54: Use a Backward Euler scheme for population growth</h2>

<p>
We consider the ODE problem \( N'(t)=rN(t) \),
\( N(0)=N_0 \). At some time, \( t_n=n\Delta t \),
we can approximate the derivative \( N'(t_n) \) by a <em>backward difference</em>,
see Figure <a href="._p4c-bootstrap-Python022.html#sec:de:fig:BE">38</a>:

$$ N'(t_n)\approx \frac{N(t_n) - N(t_n-\Delta t)}{\Delta t} = \frac{N^n - N^{n-1}}{\Delta t},$$

which leads to

$$ \frac{N^n - N^{n-1}}{\Delta t} = rN^n\thinspace,$$

called the <em>Backward Euler scheme</em>.

<p>
<b>a)</b>
Find an expression for the \( N^n \) in terms of \( N^{n-1} \) and formulate
an algorithm for computing \( N^n \), \( n=1,2,\ldots,N_t \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_54_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_54_1">

<p>
Re-arranging the given expression leads to:

$$
\begin{equation}
N^n = \frac{N^{n-1}}{1-r\Delta t}.
\tag{4.84}
\end{equation}
$$

<p>
Noting that the right hand side may be expressed by use of \( N^0 \), we
may formulate the following algorithm:

<p>
For \( n = 1,2,...,N \) compute

$$
\begin{equation}
N^n = \left(1-r\Delta t\right)^{-n} N^0.
\tag{4.85}
\end{equation}
$$

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Implement the algorithm in a) in a function <code>growth_BE(N_0, dt, T)</code>
for solving \( N'=rN \), \( N(0)=N_0 \), \( t\in (0,T] \), with time step \( \Delta t \) (<code>dt</code>).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_54_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_54_2">

<p>
See code presented below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>c)</b>
Implement the Forward Euler scheme in a function <code>growth_FE(N_0, dt, T)</code>
as described in b).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_54_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_54_3">

<p>
With a demo function named <code>application</code>, all of the code appears as:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace, exp
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">growth_BE</span>(r, N_0, dt, T):
    N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
    N <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
    N[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> N_0
    
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, N_t<span style="color: #666666">+1</span>):
        N[n] <span style="color: #666666">=</span> (<span style="color: #666666">1-</span>r<span style="color: #666666">*</span>dt)<span style="color: #666666">**</span>(<span style="color: #666666">-</span>n) <span style="color: #666666">*</span> N_0
    <span style="color: #008000; font-weight: bold">return</span> N

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">growth_FE</span>(r, N_0, dt, T):
    N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
    N <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
    N[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> N_0
    
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, N_t<span style="color: #666666">+1</span>):
        N[n] <span style="color: #666666">=</span> (<span style="color: #666666">1+</span>r<span style="color: #666666">*</span>dt)<span style="color: #666666">**</span>n <span style="color: #666666">*</span> N_0
    <span style="color: #008000; font-weight: bold">return</span> N

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">application</span>():
    r <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    N_0 <span style="color: #666666">=</span> <span style="color: #666666">1</span>; T <span style="color: #666666">=</span> <span style="color: #666666">6</span>
    dt <span style="color: #666666">=</span> <span style="color: #666666">0.5</span>
    N_BE <span style="color: #666666">=</span> growth_BE(r, N_0, dt, T)
    N_FE <span style="color: #666666">=</span> growth_FE(r, N_0, dt, T)
    time <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))<span style="color: #666666">+1</span>)
    fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
    l1, l2, l3 <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>plot(time, N_BE, time, N_FE, time, exp(time))
    fig<span style="color: #666666">.</span>legend((l1, l2, l3), (<span style="color: #BA2121">&#39;N (BE)&#39;</span>, <span style="color: #BA2121">&#39;N (FE)&#39;</span>, <span style="color: #BA2121">&#39;e^t (true)&#39;</span>),\
                                                  <span style="color: #BA2121">&#39;upper left&#39;</span>)
    plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&#39;Timestep 0.5&#39;</span>)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>);  
    plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp1.pdf&#39;</span>)

    dt <span style="color: #666666">=</span> <span style="color: #666666">0.05</span>
    N_BE <span style="color: #666666">=</span> growth_BE(r, N_0, dt, T)
    N_FE <span style="color: #666666">=</span> growth_FE(r, N_0, dt, T)
    time <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))<span style="color: #666666">+1</span>)
    fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure() 
    l1, l2, l3 <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>plot(time, N_BE, time, N_FE, time, exp(time))
    fig<span style="color: #666666">.</span>legend((l1, l2, l3), (<span style="color: #BA2121">&#39;N (BE)&#39;</span>, <span style="color: #BA2121">&#39;N (FE)&#39;</span>, <span style="color: #BA2121">&#39;e^t (true)&#39;</span>),\
                                                  <span style="color: #BA2121">&#39;upper left&#39;</span>)
    plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&#39;Timestep 0.05&#39;</span>)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>);  
    plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp2.pdf&#39;</span>)

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    application()
</pre></div>
<p>
The two plots generated are given below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>d)</b>
Compare visually the solution produced by the Forward and Backward
Euler schemes with the exact solution when \( r=1 \) and \( T=6 \). Make
two plots, one with
\( \Delta t = 0.5 \) and one with \( \Delta t=0.05 \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_54_4" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_54_4">

<p>
With a time step of 0.5, the BE approach deviates substantially more
from the true solution than the FE. This is a consequence of the very large
time step used.

<p>
<center><p><img src="figs/growth_BE_FE_dt05.png" align="bottom" width=600></p></center>

<p>
Reducing the time step to 0.05 improves the situation for BE, so that
FE and BE now give approximately the same error at each time step, but
with opposite signs.

<p>
<center><p><img src="figs/growth_BE_FE_dt005.png" align="bottom" width=600></p></center>

<p>
With both time steps and both methods, the error grows with time. It should
be noted that the graph produced with FE is <em>below</em> the true solution, while
the one from BE is <em>above</em>. This should be expected because of the following.
The slope of the true graph (or solution) increases with time. The FE does, at
each time step, use the derivative from the <em>beginning</em> of the time step. This
derivative is the smallest on the time interval covered by that time step. Therefore,
the corresponding graph ends up below the true one. With BE, it is the other
way around, since it uses the derivative at the <em>end</em> of each timestep, which
then is the largest derivative on the time interval covered by that time step.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>growth_BE.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:pg:CN">Exercise 55: Use a Crank-Nicolson scheme for population growth</h2>

<p>
It is recommended to do <a href="#sec:de:exer:pg:BE">Exercise 54: Use a Backward Euler scheme for population growth</a> prior to the
present one.
Here we look at the same population growth model \( N'(t)=rN(t) \), \( N(0)=N_0 \).
The time derivative \( N'(t) \) can be approximated by various types of
finite differences. <a href="#sec:de:exer:pg:BE">Exercise 54: Use a Backward Euler scheme for population growth</a> considers
a backward difference (Figure <a href="._p4c-bootstrap-Python022.html#sec:de:fig:BE">38</a>), while the section <a href="._p4c-bootstrap-Python020.html#sec:de:pg:numerics">Numerical solution</a> explained the forward difference (Figure <a href="._p4c-bootstrap-Python020.html#sec:de:fig:FE">21</a>).
A <em>centered difference</em> is more accurate than a backward or forward
difference:

$$ N'(t_n+\frac{1}{2}\Delta t)\approx\frac{N(t_n+\Delta t)-N(t_n)}{\Delta t}=
\frac{N^{n+1}-N^n}{\Delta t}\thinspace .$$

This type of difference, applied at the point \( t_{n+\frac{1}{2}}=t_n +
\frac{1}{2}\Delta t \), is illustrated geometrically in Figure
<a href="._p4c-bootstrap-Python022.html#sec:de:fig:CN">39</a>.

<p>
<b>a)</b>
Insert the finite difference approximation in the ODE \( N'=rN \) and
solve for the unknown \( N^{n+1} \), assuming \( N^n \) is already computed and
hence known. The resulting computational scheme is often referred
to as a <em>Crank-Nicolson</em> scheme.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_55_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_55_1">

<p>
With a central difference approximation used for the derivative, we also
need to reformulate the function (expressing the derivative) on the right
hand side to include the unknowns that we want only. For the right hand
side we use the average of the derivative from \( n \) and \( n+1 \), i.e. at
each end of the time step. We then get

$$ \frac{N^{n+1} - N^n}{\Delta t} = \frac{1}{2}(rN^n + rN^{n+1})\thinspace,$$

<p>
which means that

$$ N^{n+1} - \frac{\Delta t}{2}rN^{n+1} = N^n + \frac{\Delta t}{2}(rN^n)\thinspace.$$

<p>
Isolating \( N^{n+1} \), we get the Crank-Nicolson scheme as

$$ N^{n+1} =  \frac{1+\frac{\Delta t}{2}r}{1-\frac{\Delta t}{2}r} N^n\thinspace.$$

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Implement the algorithm in a) in a function <code>growth_CN(N_0, dt, T)</code>
for solving \( N'=rN \), \( N(0)=N_0 \), \( t\in (0,T] \), with time step \( \Delta t \) (<code>dt</code>).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_55_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_55_2">

<p>
See code presented below.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>c)</b>
Make plots for comparing
the Crank-Nicolson scheme with the Forward and Backward Euler
schemes in the same test problem as in
<a href="#sec:de:exer:pg:BE">Exercise 54: Use a Backward Euler scheme for population growth</a>.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_55_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_55_3">

<p>
With a demo function named <code>application</code>, all of the code appears as:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">growth_BE</span> <span style="color: #008000; font-weight: bold">import</span> growth_BE, growth_FE
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace, exp
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">growth_CN</span>(r, N_0, dt, T):
    N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
    N <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
    N[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> N_0
    
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>, N_t):
        N[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> ( (<span style="color: #666666">1+0.5*</span>dt<span style="color: #666666">*</span>r)<span style="color: #666666">/</span>(<span style="color: #666666">1-0.5*</span>dt<span style="color: #666666">*</span>r) ) <span style="color: #666666">*</span> N[n]
    <span style="color: #008000; font-weight: bold">return</span> N

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">application</span>():
    r <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    N_0 <span style="color: #666666">=</span> <span style="color: #666666">1</span>; T <span style="color: #666666">=</span> <span style="color: #666666">6</span>
    dt <span style="color: #666666">=</span> <span style="color: #666666">0.5</span>
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&quot;hei1&quot;</span>
    N_CN <span style="color: #666666">=</span> growth_CN(r, N_0, dt, T)    
    N_BE <span style="color: #666666">=</span> growth_BE(r, N_0, dt, T)
    N_FE <span style="color: #666666">=</span> growth_FE(r, N_0, dt, T)
    time <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))<span style="color: #666666">+1</span>)
    fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
    l1, l2, l3, l4 <span style="color: #666666">=</span> \
      plt<span style="color: #666666">.</span>plot(time, N_BE, time, N_FE, time, N_CN, time, exp(time))
    fig<span style="color: #666666">.</span>legend((l1, l2, l3, l4),\
        (<span style="color: #BA2121">&#39;N (BE)&#39;</span>, <span style="color: #BA2121">&#39;N (FE)&#39;</span>, <span style="color: #BA2121">&#39;N (CN)&#39;</span>, <span style="color: #BA2121">&#39;e^t (true)&#39;</span>), <span style="color: #BA2121">&#39;upper left&#39;</span>)
    plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&#39;Timestep 0.5&#39;</span>)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>);  
    plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp1.pdf&#39;</span>)

    dt <span style="color: #666666">=</span> <span style="color: #666666">0.05</span>
    N_CN <span style="color: #666666">=</span> growth_CN(r, N_0, dt, T)    
    N_BE <span style="color: #666666">=</span> growth_BE(r, N_0, dt, T)
    N_FE <span style="color: #666666">=</span> growth_FE(r, N_0, dt, T)
    time <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))<span style="color: #666666">+1</span>)
    fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
    l1, l2, l3, l4 <span style="color: #666666">=</span> \
      plt<span style="color: #666666">.</span>plot(time, N_BE, time, N_FE, time, N_CN, time, exp(time))
    fig<span style="color: #666666">.</span>legend((l1, l2, l3, l4),\
        (<span style="color: #BA2121">&#39;N (BE)&#39;</span>, <span style="color: #BA2121">&#39;N (FE)&#39;</span>, <span style="color: #BA2121">&#39;N (CN)&#39;</span>, <span style="color: #BA2121">&#39;e^t (true)&#39;</span>), <span style="color: #BA2121">&#39;upper left&#39;</span>)
    plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&#39;Timestep 0.05&#39;</span>)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>);  
    plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp2.pdf&#39;</span>)

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    application()
</pre></div>
<p>
With a time step of 0.5, we get the following plot:

<p>
<center><p><img src="figs/growth_CN_dt05.png" align="bottom" width=600></p></center>

<p>
Reducing the time step to 0.05, it changes into:

<p>
<center><p><img src="figs/growth_CN_dt005.png" align="bottom" width=600></p></center>

<p>
We observe that CN produces the best solution of the three alternatives.
This should be expected, since it is the most accurate one (second order
accuracy compared to first order with FE and BE).

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>growth_CN.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:fd:Taylor">Exercise 56: Understand finite differences via Taylor series</h2>

<p>
The Taylor series around a point \( x=a \) can for a function \( f(x) \) be
written

$$
\begin{align*}
f(x) &= f(a) + \frac{d}{dx}f(a)(x-a) + \frac{1}{2!}\frac{d^2}{dx^2}f(a)(x-a)^2
\\ 
&\quad + \frac{1}{3!}\frac{d^3}{dx^3}f(a)(x-a)^3 + \ldots\\ 
& =
\sum_{i=0}^\infty \frac{1}{i!}\frac{d^i}{dx^i}f(a)(x-a)^i\thinspace .
\end{align*}
$$

For a function of time, as addressed in our ODE problems, we would
use \( u \) instead of \( f \), \( t \) instead of \( x \), and a time point \( t_n \) instead
of \( a \):

$$
\begin{align*}
u(t) &= u(t_n) + \frac{d}{dt}u(t_n)(t-t_n) +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)(t-t_n)^2\\ 
&\quad  + \frac{1}{3!}\frac{d^3}{dt^3}u(t_n)(t-t_n)^3 + \ldots\\ 
& =
\sum_{i=0}^\infty \frac{1}{i!}\frac{d^i}{dt^i}u(t_n)(t-t_n)^i\thinspace .
\end{align*}
$$

<p>
<b>a)</b>
A forward finite difference approximation to the derivative \( f'(a) \) reads

$$ u'(t_n) \approx \frac{u(t_n+\Delta t)- u(t_n)}{\Delta t}\thinspace .$$

We can justify this formula mathematically through Taylor series.
Write up the Taylor series for \( u(t_n+\Delta t) \) (around \( t=t_n \), as
given above), and then solve the expression with respect to \( u'(t_n) \).
Identify, on the right-hand side, the finite difference approximation <em>and</em>
an infinite series. This series is then the error in the finite difference
approximation. If \( \Delta t \) is assumed small (i.e. \( \Delta t < < 1 \)),
\( \Delta t \) will be much larger than \( \Delta t^2 \), which will be much
larger than \( \Delta t^3 \), and so on. The <em>leading order term</em> in the
series for the error, i.e., the error with the least power of \( \Delta t \)
is a good approximation of the error. Identify this term.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_56_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_56_2">

<p>
We get

$$
\begin{align*}
u(t_n+\Delta t) &= u(t_n) + \frac{d}{dt}u(t_n)\Delta t +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t^2
 + \frac{1}{3!}\frac{d^3}{dt^3}u(t_n)\Delta t^3 + \ldots\\ 
\frac{d}{dt}u(t_n) & = \frac{u(t_n+\Delta t) - u(t_n)}{\Delta t} -
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t -
 \frac{1}{3!}\frac{d^3}{dt^3}u(t_n)\Delta t^2 + \ldots\\ 
\thinspace .
\end{align*}
$$

The finite difference approximation is found as the first term on the right
hand side, while the remaining terms make up the infinite series that represents
the error of the finite difference approximation.

<p>
The leading order error term is therefore \( -\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t \).

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Repeat a) for a backward difference:

$$ u'(t_n) \approx \frac{u(t_n)- u(t_n-\Delta t)}{\Delta t}\thinspace .$$

This time, write up the Taylor series for \( u(t_n-\Delta t) \) around
\( t_n \). Solve with respect to \( u'(t_n) \), and identify the leading order
term in the error. How is the error compared to the forward difference?

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_56_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_56_3">

<p>
We get

$$
\begin{align*}
u(t_n-\Delta t) &= u(t_n) - \frac{d}{dt}u(t_n)\Delta t +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t^2
 - \frac{1}{3!}\frac{d^3}{dt^3}u(t_n)\Delta t^3 + \ldots\\ 
\frac{d}{dt}u(t_n) & = \frac{u(t_n) - u(t_n-\Delta t)}{\Delta t} +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t -
 \frac{1}{3!}\frac{d^3}{dt^3}u(t_n)\Delta t^2 + \ldots\\ 
\thinspace .
\end{align*}
$$

The finite difference approximation is found as the first term on the right
hand side, while the remaining terms make up the infinite series that represents
the error of the finite difference approximation.

<p>
The leading order error term is therefore \( +\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t \),
which is of the same magnitude as the corresponding error in a), but with opposite sign.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>c)</b>
A centered difference approximation to the derivative,
as explored in <a href="#sec:de:exer:pg:CN">Exercise 55: Use a Crank-Nicolson scheme for population growth</a>,
can be written

$$ u'(t_n+\frac{1}{2}\Delta t) \approx \frac{u(t_n+\Delta t)- u(t_n)}{\Delta t}\thinspace .$$

Write up the Taylor series for \( u(t_n) \) around \( t_n+\frac{1}{2}\Delta t \)
and the Taylor series for \( u(t_n+\Delta t) \) around \( t_n+\frac{1}{2}\Delta t \).
Subtract the two series, solve with respect to
\( u'(t_n+\frac{1}{2}\Delta t) \), identify the finite difference approximation
and the error terms on the right-hand side, and write up the leading order
error term. How is this term compared to the ones for the forward and
backward differences?

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_56_4" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_56_4">

<p>
We write

$$
\begin{align*}
u(t_n) &= u(t_n+\frac{\Delta t}{2}) - \frac{d}{dt}u(t_n+\frac{\Delta t}{2})\frac{\Delta t}{2} +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n+\frac{\Delta t}{2})\left(\frac{\Delta t}{2}\right)^2\\ 
&\quad - \frac{1}{3!}\frac{d^3}{dt^3}u(t_n+\frac{\Delta t}{2})\left(\frac{\Delta t}{2}\right)^3 + \ldots\\ 
u(t_n+\Delta t) &= u(t_n+\frac{\Delta t}{2}) + \frac{d}{dt}u(t_n+\frac{\Delta t}{2})\frac{\Delta t}{2} +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n+\frac{\Delta t}{2})\left(\frac{\Delta t}{2}\right)^2\\ 
&\quad + \frac{1}{3!}\frac{d^3}{dt^3}u(t_n+\frac{\Delta t}{2})\left(\frac{\Delta t}{2}\right)^3 + \ldots\\ 
\thinspace .
\end{align*}
$$

If we next subtract the first of these two equations from the last one, we may proceed as
$$
\begin{align*}
u(t_n+\Delta t) - u(t_n) &= 2\frac{d}{dt}u(t_n+\frac{\Delta t}{2})\frac{\Delta t}{2} +
  2\frac{1}{3!}\frac{d^3}{dt^3}u(t_n+\frac{\Delta t}{2})\left(\frac{\Delta t}{2}\right)^3 + \ldots\\ 
\frac{d}{dt}u(t_n+\frac{\Delta t}{2}) &= \frac{u(t_n+\Delta t) - u(t_n)}{\Delta t} -
 \frac{1}{3!}\frac{d^3}{dt^3}u(t_n+\frac{\Delta t}{2})\left(\frac{\Delta t}{2}\right)^2 - \ldots\\ 
\thinspace .
\end{align*}
$$

The finite difference approximation is found as the first term on the right
hand side, while the remaining terms make up the infinite series that represents
the error of the finite difference approximation.

<p>
The leading order error term is
\( -\frac{1}{3!}\frac{d^3}{dt^3}u(t_n+\frac{\Delta t}{2})\left(\frac{\Delta t}{2}\right)^2 \).
This term will be smaller than the corresponding error terms from the previous approximations
since \( \frac{\Delta t}{2}^2 < < \Delta t \).

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>d)</b>
Can you use the leading order error terms in a)-c) to explain the
visual observations in the numerical experiment in
<a href="#sec:de:exer:pg:CN">Exercise 55: Use a Crank-Nicolson scheme for population growth</a>?

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_56_5" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_56_5">

<p>
The error term for the centered difference is \( \Delta t^2 \) and hence
smaller than the error terms for the forward and backward differences.
Therefore, the Crank-Nicolson curve is closer to the analytical solution.
Also, the error terms of the forward and backward differences are
the same, except for the sign, which explains why the corresponding curves
lie on each side of the analytical solution, with approximately the
same distance. Note: the leading order error term is only a good
approximation to the true error as \( \Delta t\rightarrow 0 \), so for
small \( \Delta t \), the forward and backward schemes will deviate
an equal amount from the analytical solution in the center, but for
large \( \Delta t \) errors will deviate from this observation (and,
in particular, the backward scheme may give oscillatory solutions for
large \( \Delta t \) in this problem).

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>e)</b>
Find the leading order error term in the following standard
finite difference approximation
to the second-order derivative:

$$ u''(t_n) \approx \frac{u(t_n+\Delta t)- 2u(t_n) + u(t_n-\Delta t)}{\Delta t}\thinspace .$$

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_56_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_56_1">

<p>
Express \( u(t_n\pm \Delta t) \) via Taylor series and insert them in
the difference formula.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_56_6" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_56_6">

<p>
We write

$$
\begin{align*}
u(t_n+\Delta t) &= u(t_n) + \frac{d}{dt}u(t_n)\Delta t +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t^2 +
 \frac{1}{3!}\frac{d^3}{dt^3}u(t_n)\Delta t^3 + \ldots\\ 
u(t_n-\Delta t) &= u(t_n) - \frac{d}{dt}u(t_n)\Delta t +
\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t^2 -
 \frac{1}{3!}\frac{d^3}{dt^3}u(t_n)\Delta t^3 + \ldots\\ 
\thinspace .
\end{align*}
$$

If we now add the two equations, it gives us
$$ u(t_n+\Delta t) + u(t_n-\Delta t) = 2 u(t_n) +
2\frac{1}{2!}\frac{d^2}{dt^2}u(t_n)\Delta t^2 +
2\frac{1}{4!}\frac{d^4}{dt^4}u(t_n)\Delta t^4 + \ldots\thinspace .$$

This allows us to isolate \( u''(t_n) \) on the left hand side as
$$ \frac{d^2}{dt^2}u(t_n) = \frac{u(t_n+\Delta t) - 2 u(t_n) + u(t_n-\Delta t)}{\Delta t^2} -
2\frac{1}{4!}\frac{d^4}{dt^4}u(t_n)\Delta t^2 - \ldots\thinspace .$$

The leading error term therefore appears as \( -2\frac{1}{4!}\frac{d^4}{dt^4}u(t_n)\Delta t^2 \).

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>Taylor_differences.pdf</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:vib:BE">Exercise 57: Use a Backward Euler scheme for oscillations</h2>

<p>
Consider <a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.43">(4.43)</a>-<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.44">(4.44)</a>
modeling an oscillating engineering system. This \( 2\times 2 \) ODE system
can be solved by the <em>Backward Euler scheme</em>, which is based on
discretizing derivatives by collecting information backward
in time. More specifically, \( u'(t) \) is approximated as

$$ u'(t) \approx \frac{u(t) - u(t-\Delta t)}{\Delta t}\thinspace .$$

A general vector ODE \( u'=f(u,t) \), where \( u \) and \( f \) are vectors,
can use this approximation as follows:

$$ \frac{u^{n} - u^{n-1}}{\Delta t} = f(u^n,t_n),$$

which leads to an equation for the new value \( u^n \):

$$ u^n -\Delta tf(u^n,t_n) = u^{n-1}\thinspace .$$

For a general \( f \), this is a system of <em>nonlinear algebraic equations</em>.

<p>
However, the ODE <a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.43">(4.43)</a>-<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.44">(4.44)</a>
is <em>linear</em>, so a Backward Euler scheme leads to a system of two
algebraic equations for two unknowns:

$$
\begin{align}
u^{n} - \Delta t v^{n} &= u^{n-1},
\tag{4.86}\\ 
v^{n} + \Delta t \omega^2 u^{n} &= v^{n-1}
\tag{4.87}
\thinspace .
\end{align}
$$

<p>
<b>a)</b>
Solve the system for \( u^n \) and \( v^n \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_57_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_57_1">

<p>
In the first of these equations, we may isolate \( u^n \) on the left hand side.
This gives
$$ u^n = \Delta t v^n + u^{n-1}\thinspace .$$

Inserting this for \( u^n \) in the second equation, we can solve for \( v^n \). That is,
$$ v^n + \Delta t \omega^2 (\Delta t v^n + u^{n-1}) = v^{n-1}\thinspace ,$$

so that
$$ v^n = \frac{1}{1 + (\Delta t \omega)^2}(-\Delta t \omega^2 u^{n-1} + v^{n-1})\thinspace .$$

Finally, we may insert this expression for \( v^n \) into the one for \( u^n \), which gives
$$ u^n = \Delta t (\frac{1}{1 + (\Delta t \omega)^2}(-\Delta t \omega^2 u^{n-1} + v^{n-1})) + u^{n-1}\thinspace .$$

Simplifying, we arrive at
$$ u^n = \frac{\Delta t v^{n-1} + u^{n-1}}{1 + (\Delta t \omega)^2}\thinspace .$$

Thus, we have an explicit scheme for advancing the solution \( v^n \) and \( u^n \) in time.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Implement the found formulas for \( u^n \) and \( v^n \)
in a program for computing the entire numerical solution of
<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.43">(4.43)</a>-<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.44">(4.44)</a>.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_57_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_57_2">

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace, pi, cos
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

omega <span style="color: #666666">=</span> <span style="color: #666666">2</span>
P <span style="color: #666666">=</span> <span style="color: #666666">2*</span>pi<span style="color: #666666">/</span>omega
<span style="color: #408080; font-style: italic">#dt = P/20</span>
dt <span style="color: #666666">=</span> P<span style="color: #666666">/2000</span>
T <span style="color: #666666">=</span> <span style="color: #666666">3*</span>P
N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, N_t<span style="color: #666666">+1</span>)

u <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
v <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)

<span style="color: #408080; font-style: italic"># Initial condition</span>
X_0 <span style="color: #666666">=</span> <span style="color: #666666">2</span>
u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> X_0
v[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

<span style="color: #408080; font-style: italic"># Step equations forward in time</span>
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>,N_t<span style="color: #666666">+1</span>):
    u[n] <span style="color: #666666">=</span> (<span style="color: #666666">1./</span>(<span style="color: #666666">1+</span>(dt<span style="color: #666666">*</span>omega)<span style="color: #666666">**2</span>)) <span style="color: #666666">*</span> (dt<span style="color: #666666">*</span>v[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> u[n<span style="color: #666666">-1</span>])
    v[n] <span style="color: #666666">=</span> (<span style="color: #666666">1./</span>(<span style="color: #666666">1+</span>(dt<span style="color: #666666">*</span>omega)<span style="color: #666666">**2</span>)) <span style="color: #666666">*</span> (<span style="color: #666666">-</span>dt<span style="color: #666666">*</span>omega<span style="color: #666666">**2*</span>u[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> v[n<span style="color: #666666">-1</span>])

fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
l1, l2 <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>plot(t, u, <span style="color: #BA2121">&#39;b-&#39;</span>, t, X_0<span style="color: #666666">*</span>cos(omega<span style="color: #666666">*</span>t), <span style="color: #BA2121">&#39;r--&#39;</span>)
fig<span style="color: #666666">.</span>legend((l1, l2), (<span style="color: #BA2121">&#39;numerical&#39;</span>, <span style="color: #BA2121">&#39;exact&#39;</span>), <span style="color: #BA2121">&#39;upper right&#39;</span>)
plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
plt<span style="color: #666666">.</span>show()
plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>); plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>)
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>c)</b>
Run the program with a \( \Delta t \) corresponding to 20 time steps per
period of the oscillations (see the section <a href="._p4c-bootstrap-Python022.html#sec:de:vib:special">Programming the numerical method; the special case</a>
for how to find such a \( \Delta t \)). What do you observe?
Increase to 2000 time steps per period. How much does this improve
the solution?

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_57_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_57_3">

<p>
With 20 time steps per period, the oscillations develop as

<p>
<center><p><img src="figs/osc_BE_20.png" align="bottom" width=600></p></center>

<p>
Changing to 2000 time steps per period, the solution improves dramatically into

<p>
<center><p><img src="figs/osc_BE_2000.png" align="bottom" width=600></p></center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>osc_BE.py</code>.

<p>
<!-- Closing remarks for this Exercise -->

<h3 id="___sec191">Remarks </h3>

<p>
While the Forward Euler method applied to oscillation problems
\( u''+\omega^2u=0 \) gives growing amplitudes, the Backward Euler
method leads to significantly damped amplitudes.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:SIR:Heun">Exercise 58: Use Heun's method for the SIR model</h2>

<p>
Make a program that computes the solution of the SIR model from
the section <a href="._p4c-bootstrap-Python021.html#sec:de:flu">Spreading of a flu</a> both by the Forward Euler method and by Heun's method
(or equivalently: the 2nd-order Runge-Kutta method) from
the section <a href="._p4c-bootstrap-Python022.html#sec:de:osc:Heun">The 2nd-order Runge-Kutta method (or Heun's method)</a>. Compare the two methods in
the simulation case from the section <a href="._p4c-bootstrap-Python021.html#sec:de:flu:prog:spec">Programming the numerical method; the special case</a>.
Make two comparison plots, one for a large and one for a
small time step. Experiment to find what &quot;large&quot; and &quot;small&quot;
should be: the large one gives significant differences, while
the small one lead to very similar curves.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_58_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_58_1">

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> zeros, linspace
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #408080; font-style: italic"># Time unit: 1 h</span>
beta <span style="color: #666666">=</span> <span style="color: #666666">10./</span>(<span style="color: #666666">40*8*24</span>)
gamma <span style="color: #666666">=</span> <span style="color: #666666">3./</span>(<span style="color: #666666">15*24</span>)
<span style="color: #408080; font-style: italic">#dt = 4.0            # Small dt</span>
dt <span style="color: #666666">=</span> <span style="color: #666666">24.0</span>            <span style="color: #408080; font-style: italic"># Large dt</span>
D <span style="color: #666666">=</span> <span style="color: #666666">30</span>               <span style="color: #408080; font-style: italic"># Simulate for D days</span>
N_t <span style="color: #666666">=</span> <span style="color: #008000">int</span>(D<span style="color: #666666">*24/</span>dt)   <span style="color: #408080; font-style: italic"># Corresponding no of hours</span>

t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, N_t<span style="color: #666666">*</span>dt, N_t<span style="color: #666666">+1</span>)
S_FE <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>); I_FE <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>); R_FE <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)
S_H <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>); I_H <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>); R_H <span style="color: #666666">=</span> zeros(N_t<span style="color: #666666">+1</span>)

<span style="color: #408080; font-style: italic"># Initial condition</span>
S_FE[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">50</span>; I_FE[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>; R_FE[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
S_H[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">50</span>;  I_H[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>;  R_H[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>

<span style="color: #408080; font-style: italic"># Step equations forward in time</span>
<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(N_t):
    <span style="color: #408080; font-style: italic"># FE</span>
    S_FE[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> S_FE[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S_FE[n]<span style="color: #666666">*</span>I_FE[n]
    I_FE[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> I_FE[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S_FE[n]<span style="color: #666666">*</span>I_FE[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I_FE[n]
    R_FE[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> R_FE[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I_FE[n]
    <span style="color: #408080; font-style: italic"># H  (predict and then update)</span>
    S_p <span style="color: #666666">=</span> S_H[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S_H[n]<span style="color: #666666">*</span>I_H[n]
    I_p <span style="color: #666666">=</span> I_H[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>beta<span style="color: #666666">*</span>S_H[n]<span style="color: #666666">*</span>I_H[n] <span style="color: #666666">-</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I_H[n]
    R_p <span style="color: #666666">=</span> R_H[n] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>gamma<span style="color: #666666">*</span>I_H[n]

    S_H[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> S_H[n] <span style="color: #666666">-</span> (dt<span style="color: #666666">/2.0</span>)<span style="color: #666666">*</span>(beta<span style="color: #666666">*</span>S_H[n]<span style="color: #666666">*</span>I_H[n] <span style="color: #666666">+</span>\
                                              beta<span style="color: #666666">*</span>S_p<span style="color: #666666">*</span>I_p)
    I_H[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> I_H[n] <span style="color: #666666">+</span> \
               (dt<span style="color: #666666">/2.0</span>)<span style="color: #666666">*</span>(beta<span style="color: #666666">*</span>S_H[n]<span style="color: #666666">*</span>I_H[n] <span style="color: #666666">-</span> gamma<span style="color: #666666">*</span>I_H[n] <span style="color: #666666">+</span>\
                         beta<span style="color: #666666">*</span>S_p<span style="color: #666666">*</span>I_p <span style="color: #666666">-</span> gamma<span style="color: #666666">*</span>I_p)
    R_H[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> R_H[n] <span style="color: #666666">+</span> (dt<span style="color: #666666">/2.0</span>)<span style="color: #666666">*</span>(gamma<span style="color: #666666">*</span>I_H[n] <span style="color: #666666">+</span> gamma<span style="color: #666666">*</span>I_p )

fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
l1, l2, l3, l4, l5, l6 <span style="color: #666666">=</span> \
       plt<span style="color: #666666">.</span>plot(t, S_FE, t, I_FE, t, R_FE, t, S_H, t, I_H, t, R_H)
fig<span style="color: #666666">.</span>legend((l1, l2, l3, l4, l5, l6), \
         (<span style="color: #BA2121">&#39;S (FE)&#39;</span>, <span style="color: #BA2121">&#39;I (FE)&#39;</span>, <span style="color: #BA2121">&#39;R (FE)&#39;</span>, <span style="color: #BA2121">&#39;S (H)&#39;</span>, <span style="color: #BA2121">&#39;I (H)&#39;</span>, <span style="color: #BA2121">&#39;R (H)&#39;</span>),\
          <span style="color: #BA2121">&#39;upper right&#39;</span>)
plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;hours&#39;</span>)
plt<span style="color: #666666">.</span>show()
plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>); plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>)
</pre></div>
<p>
With a (large) time step of \( 24 h \), we get the following behavior,

<p>
<center><p><img src="figs/SIR_H_large_dt_eq_24.png" align="bottom" width=600></p></center>

<p>
Reducing the time step to \( 4 h \), the curves get very similar.

<p>
<center><p><img src="figs/SIR_H_small_dt_eq_4.png" align="bottom" width=600></p></center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>SIR_Heun.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:odespy:decay">Exercise 59: Use Odespy to solve a simple ODE</h2>

<p>
Solve

$$ u' = -au + b,\quad u(0)=U_0,\quad t\in (0,T]$$

by the Odespy software. Let the problem parameters \( a \) and \( b \)
be arguments to the right-hand side function that specifies the
ODE to be solved. Plot the solution for the case when
\( a=2 \), \( b=1 \), \( T=6/a \), and we use 100 time intervals in \( [0,T] \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_59_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_59_1">

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">odespy</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(u, t, a, b):
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">-</span>a<span style="color: #666666">*</span>u <span style="color: #666666">+</span> b

<span style="color: #408080; font-style: italic"># Problem parameters</span>
a <span style="color: #666666">=</span> <span style="color: #666666">2</span>
b <span style="color: #666666">=</span> <span style="color: #666666">1</span>
U0 <span style="color: #666666">=</span> <span style="color: #666666">2</span>
method <span style="color: #666666">=</span> odespy<span style="color: #666666">.</span>RK2

<span style="color: #408080; font-style: italic"># Run Odespy solver</span>
solver <span style="color: #666666">=</span> method(f, f_args<span style="color: #666666">=</span>[a, b])
solver<span style="color: #666666">.</span>set_initial_condition(U0)
T <span style="color: #666666">=</span> <span style="color: #666666">6.0/</span>a  <span style="color: #408080; font-style: italic"># final simulation time</span>
N_t <span style="color: #666666">=</span> <span style="color: #666666">100</span>  <span style="color: #408080; font-style: italic"># no of intervals</span>
time_points <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, T, N_t<span style="color: #666666">+1</span>)
u, t <span style="color: #666666">=</span> solver<span style="color: #666666">.</span>solve(time_points)

plt<span style="color: #666666">.</span>plot(t, u)
plt<span style="color: #666666">.</span>show
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>odespy_demo.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:osc:BE">Exercise 60: Set up a Backward Euler scheme for oscillations</h2>

<p>
Write the ODE \( u'' + \omega^2u=0 \) as a system of two first-order
ODEs and discretize these with backward differences as illustrated
in Figure <a href="._p4c-bootstrap-Python022.html#sec:de:fig:BE">38</a>. The resulting method is referred to as
a Backward Euler scheme. Identify the matrix and right-hand side
of the linear system that has to be solved at each time level.
Implement the method, either from scratch yourself or using
Odespy (the name is <code>odespy.BackwardEuler</code>).
Demonstrate that contrary to a Forward Euler scheme, the Backward
Euler scheme leads to significant non-physical damping. The figure
below shows that even with 60 time steps per period, the results
after a few periods are useless:

<p>
<center><p><img src="figs/osc_odespy_BE.png" align="bottom" width=600></p></center>

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_60_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_60_1">

<p>
The first-order system is

$$
\begin{align*}
v' &= -\omega^2 u\\ 
u' &= v
\end{align*}
$$

Backward differences mean

$$
\begin{align*}
\frac{v^{n}-v^{n-1}}{\Delta t} &= -\omega^2 u^n\\ 
\frac{u^{n}-u^{n-1}}{\Delta t} &= v^n
\end{align*}
$$

Collecting the unknowns \( u^n \) and \( v^n \) on the left-hand side,

$$
\begin{align*}
v^{n} + \Delta t\omega^2 u^n &= v^{n-1} \\ 
u^{n} - \Delta t v^n &= u^{n-1}
\end{align*}
$$

shows that this is a coupled \( 2\times 2 \) system for \( u^n \) and \( v^n \):

$$ \left(\begin{array}{cc}
1 & \Delta t\omega^2\\ 
-\Delta t & 1
\end{array}\right)
\left(\begin{array}{c}
v^n\\ 
u^n
\end{array}\right)
=
\left(\begin{array}{c}
v^{n-1}\\ 
u^{n-1}
\end{array}\right)
$$

<p>
The simplest way of implementing the scheme is to use the
<code>osc_odespy.py</code> code explained in the section <a href="._p4c-bootstrap-Python022.html#sec:de:osc:odespy">Software for solving ODEs</a>
and make a call

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">compare(odespy_methods<span style="color: #666666">=</span>[odespy<span style="color: #666666">.</span>EulerCromer, odespy<span style="color: #666666">.</span>BackwardEuler],
        omega<span style="color: #666666">=2</span>, X_0<span style="color: #666666">=2</span>,number_of_periods<span style="color: #666666">=6</span>,
        time_intervals_per_period<span style="color: #666666">=60</span>)
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>osc_BE.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:osc:FE:general">Exercise 61: Set up a Forward Euler scheme for nonlinear and damped oscillations</h2>

<p>
Derive a Forward Euler method for the ODE system
<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.68">(4.68)</a>-<a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.69">(4.69)</a>.
Compare the method with the Euler-Cromer scheme for
the sliding friction problem
from the section <a href="._p4c-bootstrap-Python022.html#sec:de:vib:ode2:sliding:friction">Spring-mass system with sliding friction</a>:

<ol>
<li> Does the Forward Euler scheme give growing amplitudes?</li>
<li> Is the period of oscillation accurate?</li>
<li> What is the required time step size for the two methods to
   have visually coinciding curves?</li>
</ol>

<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_61_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_61_1">

<p>
A Forward Euler scheme is easy to derive:

$$
\begin{align}
\frac{v^{n+1}-v^n}{\Delta t} &= \frac{1}{m}\left(F(t_n) - s(u^n) - f(v^n)\right),
\tag{4.88}\\ 
\frac{u^{n+1}-u^n}{\Delta t} &= v^n,
\tag{4.89}
\end{align}
$$

which is, as usual, reordered to the algorithmic form

$$
\begin{align}
v^{n+1} &= v^n + \frac{\Delta t}{m}\left(F(t_n) - s(u^n) - f(v^n)\right),
\tag{4.90}\\ 
u^{n+1} &= u^n + \Delta t v^n\thinspace .
\tag{4.91}
\end{align}
$$

However, we have already seen that the Forward Euler method is not
well suited for simulating oscillations as the scheme gives rise
to a non-physical, growing amplitude. It remains to see how
damped systems are treated.

<p>
An implementation can be done utilizing Odespy and the <code>compare</code>
function in <code>osc_odespy_general.py</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">sliding_friction</span>():
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> tanh, sign

    f <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> v: mu<span style="color: #666666">*</span>m<span style="color: #666666">*</span>g<span style="color: #666666">*</span>sign(v)
    alpha <span style="color: #666666">=</span> <span style="color: #666666">60.0</span>
    s <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> u: k<span style="color: #666666">/</span>alpha<span style="color: #666666">*</span>tanh(alpha<span style="color: #666666">*</span>u)
    <span style="color: #408080; font-style: italic">#s = lambda u: k*u</span>
    F <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> t: <span style="color: #666666">0</span>

    g <span style="color: #666666">=</span> <span style="color: #666666">9.81</span>
    mu <span style="color: #666666">=</span> <span style="color: #666666">0.4</span>
    m <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    k <span style="color: #666666">=</span> <span style="color: #666666">1000</span>

    U_0 <span style="color: #666666">=</span> <span style="color: #666666">0.1</span>
    V_0 <span style="color: #666666">=</span> <span style="color: #666666">0</span>

    T <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    dt <span style="color: #666666">=</span> T<span style="color: #666666">/100.</span>

    methods <span style="color: #666666">=</span> [odespy<span style="color: #666666">.</span>EulerCromer, odespy<span style="color: #666666">.</span>ForwardEuler]
    compare(methods, f<span style="color: #666666">=</span>f, s<span style="color: #666666">=</span>s, F<span style="color: #666666">=</span>F, m<span style="color: #666666">=1</span>, U_0<span style="color: #666666">=</span>U_0, V_0<span style="color: #666666">=</span>V_0,
            T<span style="color: #666666">=</span>T, dt<span style="color: #666666">=</span>dt, start_of_plot<span style="color: #666666">=0</span>)
</pre></div>
<p>
With \( \Delta t =10^{-2} \) we get the plot below.

<p>
<center><p><img src="figs/osc_FE_general_dt100.png" align="bottom" width=600></p></center>

<p>
We observe that 1) the amplitude is not growing, it is decaying, but
not at all at the rate it should, compared to the Euler-Cromer
scheme (which we anticipate is fairly accurate, also for this fairly
coarse time resolution), and 2) there is a significant phase error.

<p>
Reducing \( \Delta t \) by a factor of 10 increases the accuracy
incredibly:

<p>
<center><p><img src="figs/osc_FE_general_dt1000.png" align="bottom" width=600></p></center>

<p>
Experimenting a bit, we arrive at \( \Delta t=5\cdot 10^{-3} \) as
a time step size where the two methods gives approximately equal
results:

<p>
<center><p><img src="figs/osc_FE_general_dt5000.png" align="bottom" width=600></p></center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>osc_FE_general.py</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="sec:de:exer:osc:2nd:V0ic">Exercise 62: Discretize an initial condition</h2>

<p>
Assume that the initial condition on \( u' \) is nonzero in
the finite difference method from the section <a href="._p4c-bootstrap-Python022.html#sec:de:vib:2nd">A finite difference method; undamped, linear case</a>:
\( u'(0)=V_0 \). Derive the special formula for \( u^1 \) in this case.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_62_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_62_1">

<p>
We use the same centered finite difference approximation,

$$ u'(0)\approx = \frac{u^1 - u^{-1}}{2\Delta t}=V_0,$$

which leads to

$$ u^{-1} = u^1 - 2\Delta t\,V_0\thinspace .$$

Using this expression to eliminate \( u^{-1} \) in <a href="._p4c-bootstrap-Python022.html#mjx-eqn-4.77">(4.77)</a>
leads to

$$ u^1 = u^0 + \Delta t\,V_0 - \frac{1}{2}\Delta t^2\omega^2 u^0\thinspace .$$

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>ic_with_V_0.pdf</code>.

<p>
<!-- --- end exercise --- -->

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._p4c-bootstrap-Python022.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._p4c-bootstrap-Python024.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

