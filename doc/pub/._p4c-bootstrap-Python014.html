<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Programming for Computations - A Gentle Introduction to Numerical Simulations with Python">
<meta name="keywords" content="computer program,programming,language programming,language computer,MATLAB,Octave,Fortran,C,C++,Python,Maple,Mathematica,syntax,bug,debugging,script (and scripting),implement,print,program run,program execute,code,comment,instruction,program statement,variable,assignment,calculator,text editor,Idle,prompt,program typing,program run,program execute,ipython,function,function call,atan,function input parameter,function output parameter,function return,function take a parameter,library,library function,from,import,math,module,package,linspace,xlabel,ylabel,plot,interactive use (of Python),import,keyboard arrow up/down,Python shell,operator Arithmetic,parentheses,variable type,variable name,object,float,int,str,type conversion,reserved words,variable int,variable float,variable str,variable assignment,type conversion automatic,integer division,round-off error,printing formatted,printf formatting,default,array,array element,zeros,allocate,array index,indexing zero based,indexing one based,Python zero-based indexing,array slice of,graph,hold (on/off),plot figure,title,legend,axis,hardcopy,format png,matrix mat,matrix vector product,transpose,linear algebra,matrix,vector,error message,debugging,debugger,try-exception,exception handling,program crash,program testing,program verification,program input,program output,input,raw input,list,tuple,symbolic computations,symbolic operations,symbolic simplifications,SymPy,library SymPy,WolframAlpha,Mathematica,Sage (symbolic package),Python documentation,garbage collection,variable delete,if,elif,else,colon,indent,boolean,boolean expression,True,False,boolean True,boolean False,pseudo code,operator Logical,function,function definition,def,return,argument,parameter input,parameter output,variable local,variable global,argument keyword,argument named,argument ordinary,argument positional,doc string,function handle,function local,function global,function nested,lambda function,loop for,for loop,range,loop iteration,loop index,loop double,loop multiple,loop nested,linear algebra,while loop,loop while,loop infinite,loop iteration,loop index,list,list append,list convert to array,list delete,list create,tuple,list comprehension,array sorting,Leibniz pi,Euler pi,programming game,linear interpolation,least squares method,Fourier series,integral analytically,integral exact,integral approximately,integration points,code re-use,unit tests,complex domains,Monte Carlo integration,seed (random generators),scheme,finite difference method,forward difference approximation,Forward Euler scheme,logistic model,carrying capacity,SIR model,scalar ODE,ODE scalar,vector ODE,ODE vector,system of ODEs,Heun's method,Runge-Kutta, 2nd-order method,2nd-order Runge-Kutta method,RK2,PDE,heat equation,diffusion equation,MOL forward Euler,method of lines,MOL,mesh points,cell,method of lines,unstable solutions,instability,stability criterion,Poisson equation,Laplace equation,root finding,code robust,code try-except,code exception,Newton starting value,return None,sys.exit,Idle,Emacs,Vim,Gedit,TextWrangler,Notepad++">

<title>Programming for Computations - A Gentle Introduction to Numerical Simulations with Python</title>

<!-- Bootstrap style: bootswatch_journal -->
<link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/journal/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
/* Let pre tags for code blocks have the same color as the surroundings */
pre { color: inherit; background-color: transparent; }
</style>


</head>

<!-- tocinfo
{'highest level': 0,
 'sections': [(u' Preface ', 0, None, '___sec0'),
              (u' Why learn programming? ', 3, None, '___sec1'),
              (u' Target audience and background knowledge ',
               3,
               None,
               '___sec2'),
              (u' Numerical methods ', 3, None, '___sec3'),
              (u' The computer language: Python ', 3, None, '___sec4'),
              (u' How this book is different ', 3, None, '___sec5'),
              (u' Acknowledgments ', 3, None, '___sec6'),
              (u' The first few steps ',
               0,
               u'1st:TheFirstFewSteps',
               u'1st:TheFirstFewSteps'),
              (u' What is a program? And what is programming? ',
               1,
               None,
               '___sec8'),
              (u' A Python program with variables ',
               1,
               u'1st:ex1',
               u'1st:ex1'),
              (u' The program ', 2, None, '___sec10'),
              (u' Dissection of the program ', 2, None, '___sec11'),
              (u' Why not just use a pocket calculator? ',
               2,
               None,
               '___sec12'),
              (u' The importance of using a text editor to write programs ',
               2,
               None,
               '___sec13'),
              (u' Installation of Python ', 2, None, '___sec14'),
              (u' Write and run your first program ', 2, None, '___sec15'),
              (u'  A Python program with a library function ',
               1,
               u'1st:ex2',
               u'1st:ex2'),
              (u' A Python program with vectorization and plotting ',
               1,
               u'1st:ex3',
               u'1st:ex3'),
              (u' More basic concepts ', 1, None, '___sec18'),
              (u' Using Python interactively ', 2, None, '___sec19'),
              (u' Arithmetics, parentheses and round-off errors ',
               2,
               None,
               '___sec20'),
              (u' Variables and objects ', 2, None, '___sec21'),
              (u' Integer division ', 2, None, '___sec22'),
              (u' Formatting text and numbers ', 2, None, '___sec23'),
              (u' Arrays ', 2, None, '___sec24'),
              (u' Plotting ', 2, None, '___sec25'),
              (u' Error messages and warnings ', 2, None, '___sec26'),
              (u' Input data ', 2, None, '___sec27'),
              (u' Symbolic computations ', 2, None, '___sec28'),
              (u' Concluding remarks ', 2, None, '___sec29'),
              (u' Exercises ', 1, None, '___sec30'),
              (u' Exercise 1: Error messages ',
               2,
               u'1st:exer:ErrorMessages',
               u'1st:exer:ErrorMessages'),
              (u' Exercise 2: Volume of a cube ',
               2,
               u'1st:exer:cubeVolume',
               u'1st:exer:cubeVolume'),
              (u' Exercise 3: Area and circumference of a circle ',
               2,
               u'1st:exer:areaCircle',
               u'1st:exer:areaCircle'),
              (u' Exercise 4: Volumes of three cubes ',
               2,
               u'1st:exer:volumes3cubes',
               u'1st:exer:volumes3cubes'),
              (u' Exercise 5: Average of integers ',
               2,
               u'1st:exer:averageOf5Integers',
               u'1st:exer:averageOf5Integers'),
              (u' Exercise 6: Interactive computing of volume and area ',
               2,
               u'1st:exer:cubeVolInteractively',
               u'1st:exer:cubeVolInteractively'),
              (u' Exercise 7: Peculiar results from division ',
               2,
               u'1st:exer:intDivInteractively',
               u'1st:exer:intDivInteractively'),
              (u' Exercise 8: Update variable at command prompt ',
               2,
               u'1st:exer:updateVarInteractively',
               u'1st:exer:updateVarInteractively'),
              (u' Exercise 9: Formatted print to screen ',
               2,
               u'1st:exer:printfScreen',
               u'1st:exer:printfScreen'),
              (u' Exercise 10: Python documentation and random numbers ',
               2,
               u'1st:exer:PythonDocRandom',
               u'1st:exer:PythonDocRandom'),
              (u' Basic constructions ',
               0,
               u'2nd:BasicConstructins',
               u'2nd:BasicConstructins'),
              (u' If tests, colon and indentation ', 1, None, '___sec42'),
              (u' Functions ', 1, u'sec:functions', u'sec:functions'),
              (u' For loops ', 1, u'sec:for:loops', u'sec:for:loops'),
              (u' While loops ', 1, u'sec:while:loops', u'sec:while:loops'),
              (u' Lists and tuples - alternatives to arrays ',
               1,
               u'sec:lists',
               u'sec:lists'),
              (u' Reading from and writing to files ',
               1,
               u'sec:file:reading:writing',
               u'sec:file:reading:writing'),
              (u' Exercises ', 1, None, '___sec48'),
              (u' Exercise 11: Errors with colon, indent, etc. ',
               2,
               u'2nd:exer:ErrorsColonIndent',
               u'2nd:exer:ErrorsColonIndent'),
              (u' Exercise 12: Compare integers a and b ',
               2,
               u'2nd:exer:compInt',
               u'2nd:exer:compInt'),
              (u' Exercise 13: Functions for circumference and area of a circle ',
               2,
               u'2nd:exer:funcCircArea',
               u'2nd:exer:funcCircArea'),
              (u' Exercise 14: Function for area of a rectangle ',
               2,
               u'2nd:exer:funcAreaRectangle',
               u'2nd:exer:funcAreaRectangle'),
              (u' Exercise 15: Area of a polygon ',
               2,
               u'2nd:exer:area:polygon',
               u'2nd:exer:area:polygon'),
              (u' Exercise 16: Average of integers ',
               2,
               u'2nd:exer:avNInt',
               u'2nd:exer:avNInt'),
              (u' Exercise 17: While loop with errors ',
               2,
               u'2nd:exer:whileLoopErrors',
               u'2nd:exer:whileLoopErrors'),
              (u' Exercise 18: Area of rectangle versus circle ',
               2,
               u'2nd:exer:areaRectCircle',
               u'2nd:exer:areaRectCircle'),
              (u' Exercise 19: Find crossing points of two graphs ',
               2,
               u'2nd:exer:Cross2Graphs',
               u'2nd:exer:Cross2Graphs'),
              (u' Exercise 20: Sort array with numbers ',
               2,
               u'2nd:exer:sortNumbers',
               u'2nd:exer:sortNumbers'),
              (u' Exercise 21: Compute $\\pi$ ',
               2,
               u'2nd:exer:computingPi',
               u'2nd:exer:computingPi'),
              (u' Exercise 22: Compute combinations of sets ',
               2,
               u'2nd:exer:combinatorics1',
               u'2nd:exer:combinatorics1'),
              (u' Exercise 23: Frequency of random numbers ',
               2,
               u'2nd:exer:numberOccurrence',
               u'2nd:exer:numberOccurrence'),
              (u' Remarks ', 3, None, '___sec62'),
              (u' Exercise 24: Game 21 ',
               2,
               u'2nd:exer:Game21',
               u'2nd:exer:Game21'),
              (u' Exercise 25: Linear interpolation ',
               2,
               u'2nd:exer:linearInterpol',
               u'2nd:exer:linearInterpol'),
              (u' Exercise 26: Test straight line requirement ',
               2,
               u'2nd:exer:testStraightLine',
               u'2nd:exer:testStraightLine'),
              (u' Exercise 27: Fit straight line to data ',
               2,
               u'2nd:exer:fitLine',
               u'2nd:exer:fitLine'),
              (u' Remarks ', 3, None, '___sec67'),
              (u' Exercise 28: Fit sines to straight line ',
               2,
               u'2nd:exer:fitSines',
               u'2nd:exer:fitSines'),
              (u' Remarks ', 3, None, '___sec69'),
              (u' Exercise 29: Count occurrences of a string in a string ',
               2,
               u'2nd:exer:countTextString',
               u'2nd:exer:countTextString'),
              (u' Remarks ', 3, None, '___sec71'),
              (u' Computing integrals ',
               0,
               u'sec:integrals',
               u'sec:integrals'),
              (u' Basic ideas of numerical integration ',
               1,
               u'sec:integrals:basic',
               u'sec:integrals:basic'),
              (u' Computational example ', 3, None, '___sec74'),
              (u' The composite trapezoidal rule ',
               1,
               u'sec:integrals:trap',
               u'sec:integrals:trap'),
              (u' The general formula ',
               2,
               u'sec:integrals:formula',
               u'sec:integrals:formula'),
              (u' Implementation ',
               2,
               u'sec:integrals:trap:impl',
               u'sec:integrals:trap:impl'),
              (u' Specific or general implementation? ', 3, None, '___sec78'),
              (u' Implementation with functions ', 3, None, '___sec79'),
              (u' Solving our specific problem in a session ',
               3,
               None,
               '___sec80'),
              (u' Solving our specific problem in a program ',
               3,
               None,
               '___sec81'),
              (u' Making a module ', 2, None, '___sec82'),
              (u' Alternative flat special-purpose implementation ',
               2,
               None,
               '___sec83'),
              (u' The composite midpoint method ',
               1,
               u'sec:integrals:Midpoint',
               u'sec:integrals:Midpoint'),
              (u' The idea ', 3, None, '___sec85'),
              (u' The general formula ', 2, None, '___sec86'),
              (u' Implementation ',
               2,
               u'sec:midpoint:code',
               u'sec:midpoint:code'),
              (u' Comparing the trapezoidal and the midpoint methods ',
               2,
               None,
               '___sec88'),
              (u' Testing ', 1, None, '___sec89'),
              (u' Problems with brief testing procedures ',
               2,
               None,
               '___sec90'),
              (u' Test procedures ',
               2,
               u'sec:integrals:testprocs',
               u'sec:integrals:testprocs'),
              (u' Hand-computed results ', 3, None, '___sec92'),
              (u' Solving a problem without numerical errors ',
               3,
               None,
               '___sec93'),
              (u' Demonstrating correct convergence rates ',
               3,
               None,
               '___sec94'),
              (u' Constructing unit tests and writing test functions ',
               2,
               u'sec:integrals:test:functions',
               u'sec:integrals:test:functions'),
              (u' Hand-computed numerical results ', 3, None, '___sec96'),
              (u' Solving a problem without numerical errors ',
               3,
               None,
               '___sec97'),
              (u' Demonstrating correct convergence rates ',
               3,
               None,
               '___sec98'),
              (u' Vectorization ', 1, None, '___sec99'),
              (u' Vectorizing the midpoint rule ', 3, None, '___sec100'),
              (u' Vectorizing the trapezoidal rule ', 3, None, '___sec101'),
              (u' Measuring computational speed ', 1, None, '___sec102'),
              (u' Double and triple integrals ',
               1,
               u'sec:int:double',
               u'sec:int:double'),
              (u' The midpoint rule for a double integral ',
               2,
               u'sec:int:double:midpoint',
               u'sec:int:double:midpoint'),
              (u' Derivation via one-dimensional integrals ',
               3,
               None,
               '___sec105'),
              (u' Direct derivation ', 3, None, '___sec106'),
              (u' Programming a double sum ', 3, None, '___sec107'),
              (u' Reusing code for one-dimensional integrals ',
               3,
               None,
               '___sec108'),
              (u' Verification via test functions ', 3, None, '___sec109'),
              (u' The midpoint rule for a triple integral ',
               2,
               None,
               '___sec110'),
              (u' Theory ', 3, None, '___sec111'),
              (u' Implementation ', 3, None, '___sec112'),
              (u' Monte Carlo integration for complex-shaped domains ',
               2,
               u'sec:int:complex:domain',
               u'sec:int:complex:domain'),
              (u' The Monte Carlo integration algorithm ',
               3,
               None,
               '___sec114'),
              (u' Implementation ', 3, None, '___sec115'),
              (u' Verification ', 3, None, '___sec116'),
              (u' Test function for function with random numbers ',
               3,
               None,
               '___sec117'),
              (u' Integral over a circle ', 3, None, '___sec118'),
              (u' Exercises ', 1, None, '___sec119'),
              (u' Exercise 30: Hand calculations for the trapezoidal method ',
               2,
               u'sec:exer:trap:hand',
               u'sec:exer:trap:hand'),
              (u' Exercise 31: Hand calculations for the midpoint method ',
               2,
               u'sec:exer:midpt:hand',
               u'sec:exer:midpt:hand'),
              (u' Exercise 32: Compute a simple integral ',
               2,
               u'sec:exer:trap:mid:parabola',
               u'sec:exer:trap:mid:parabola'),
              (u' Exercise 33: Hand-calculations with sine integrals ',
               2,
               u'sec:exer:hand:sine',
               u'sec:exer:hand:sine'),
              (u' Exercise 34: Make test functions for the midpoint method ',
               2,
               u'sec:exer:test:midpoint',
               u'sec:exer:test:midpoint'),
              (u' Exercise 35: Explore round-off errors with large numbers ',
               2,
               u'sec:exer:test:roundoff',
               u'sec:exer:test:roundoff'),
              (u' Exercise 36: Write test functions for $\\int_0^4\\sqrt{x}dx$ ',
               2,
               u'sec:exer:test:convrates:sqrt',
               u'sec:exer:test:convrates:sqrt'),
              (u' Remarks ', 3, None, '___sec127'),
              (u' Exercise 37: Rectangle methods ',
               2,
               u'sec:exer:rectangleMethod',
               u'sec:exer:rectangleMethod'),
              (u' Exercise 38: Adaptive integration ',
               2,
               u'sec:exer:adaptive:int',
               u'sec:exer:adaptive:int'),
              (u' Remarks ', 3, None, '___sec130'),
              (u' Exercise 39: Integrating x raised to x ',
               2,
               u'sec:exer:integrate:x2x',
               u'sec:exer:integrate:x2x'),
              (u' Exercise 40: Integrate products of sine functions ',
               2,
               u'sec:exer:sine:products',
               u'sec:exer:sine:products'),
              (u' Exercise 41: Revisit fit of sines to a function ',
               2,
               u'sec:exer:revisitFitSines',
               u'sec:exer:revisitFitSines'),
              (u' Exercise 42: Derive the trapezoidal rule for a double integral ',
               2,
               u'sec:exer:trapezoidal:2D',
               u'sec:exer:trapezoidal:2D'),
              (u' Exercise 43: Compute the area of a triangle by Monte Carlo integration ',
               2,
               u'sec:exer:MC:ellipse',
               u'sec:exer:MC:ellipse'),
              (u' Solving ordinary differential equations ',
               0,
               u'5th:SolvODEs',
               u'5th:SolvODEs'),
              (u' Population growth ', 1, u'sec:de:pg', u'sec:de:pg'),
              (u' Derivation of the model ',
               2,
               u'sec:de:pg:model',
               u'sec:de:pg:model'),
              (u' Numerical solution ',
               2,
               u'sec:de:pg:numerics',
               u'sec:de:pg:numerics'),
              (u' Programming the Forward Euler scheme; the special case ',
               2,
               u'sec:de:pg:prog1',
               u'sec:de:pg:prog1'),
              (u' Understanding the Forward Euler method ',
               2,
               u'sec:de:pg:geom',
               u'sec:de:pg:geom'),
              (u' Programming the Forward Euler scheme; the general case ',
               2,
               u'sec:de:FE:gen',
               u'sec:de:FE:gen'),
              (u' Making the population growth model more realistic ',
               2,
               None,
               '___sec143'),
              (u' Verification: exact linear solution of the discrete equations ',
               2,
               u'sec:de:growth:test:linear',
               u'sec:de:growth:test:linear'),
              (u' Spreading of diseases ', 1, None, '___sec145'),
              (u' Spreading of a flu ', 2, u'sec:de:flu', u'sec:de:flu'),
              (u' A Forward Euler method for the differential equation system ',
               2,
               u'sec:de:flu:FE',
               u'sec:de:flu:FE'),
              (u' Programming the numerical method; the special case ',
               2,
               u'sec:de:flu:prog:spec',
               u'sec:de:flu:prog:spec'),
              (u' Outbreak or not ', 2, None, '___sec149'),
              (u' Abstract problem and notation ',
               2,
               u'sec:de:flu:generic',
               u'sec:de:flu:generic'),
              (u' Programming the numerical method; the general case ',
               2,
               u'sec:de:flu:prog:generic',
               u'sec:de:flu:prog:generic'),
              (u' Time-restricted immunity ', 2, None, '___sec152'),
              (u' Incorporating vaccination ',
               2,
               u'sec:de:flu:vaccine',
               u'sec:de:flu:vaccine'),
              (u' Discontinuous coefficients: a vaccination campaign ',
               2,
               u'sec:de:flu:vaccine:discont',
               u'sec:de:flu:vaccine:discont'),
              (u' Oscillating one-dimensional systems ',
               1,
               u'sec:de:vib',
               u'sec:de:vib'),
              (u' Derivation of a simple model ', 2, None, '___sec156'),
              (u' Numerical solution ', 2, None, '___sec157'),
              (u' Programming the numerical method; the special case ',
               2,
               u'sec:de:vib:special',
               u'sec:de:vib:special'),
              (u' A magic fix of the numerical method ',
               2,
               None,
               '___sec159'),
              (u" The 2nd-order Runge-Kutta method (or Heun's method) ",
               2,
               u'sec:de:osc:Heun',
               u'sec:de:osc:Heun'),
              (u' Odespy: software for solving ODEs ',
               2,
               u'sec:de:osc:odespy',
               u'sec:de:osc:odespy'),
              (u' The 4th-order Runge-Kutta method ', 2, None, '___sec162'),
              (u' The algorithm ', 3, None, '___sec163'),
              (u' Application ', 3, None, '___sec164'),
              (u' Implementation ', 3, None, '___sec165'),
              (u' Derivation ', 3, None, '___sec166'),
              (u' More effects: damping, nonlinearity, and external forces ',
               2,
               None,
               '___sec167'),
              (u' The Euler-Cromer scheme ', 3, None, '___sec168'),
              (u' The 4-th order Runge-Kutta method ', 3, None, '___sec169'),
              (u' Illustration of linear damping ', 2, None, '___sec170'),
              (u' Illustration of linear damping with sinusoidal excitation ',
               2,
               None,
               '___sec171'),
              (u' Spring-mass system with sliding friction ',
               2,
               u'sec:de:vib:ode2:sliding:friction',
               u'sec:de:vib:ode2:sliding:friction'),
              (u' A finite difference method; undamped, linear case ',
               2,
               u'sec:de:vib:2nd',
               u'sec:de:vib:2nd'),
              (u' A finite difference method; linear damping ',
               2,
               u'sec:de:vib:2nd:damped1',
               u'sec:de:vib:2nd:damped1'),
              (u' Exercises ', 1, None, '___sec175'),
              (u' Exercise 44: Geometric construction of the Forward Euler method ',
               2,
               u'sec:de:exer:geom',
               u'sec:de:exer:geom'),
              (u' Exercise 45: Make test functions for the Forward Euler method ',
               2,
               u'sec:de:exer:FE:test1',
               u'sec:de:exer:FE:test1'),
              (u" Exercise 46: Implement and evaluate Heun's method ",
               2,
               u'sec:de:exer:Heun:pg',
               u'sec:de:exer:Heun:pg'),
              (u' Exercise 47: Find an appropriate time step; logistic model ',
               2,
               u'sec:de:exer:logistic:dtopt',
               u'sec:de:exer:logistic:dtopt'),
              (u' Exercise 48: Find an appropriate time step; SIR model ',
               2,
               u'sec:de:exer:SIR:dtopt',
               u'sec:de:exer:SIR:dtopt'),
              (u' Exercise 49: Model an adaptive vaccination campaign ',
               2,
               u'sec:de:exer:SIRV:padapt',
               u'sec:de:exer:SIRV:padapt'),
              (u' Exercise 50: Make a SIRV model with time-limited effect of vaccination ',
               2,
               u'sec:de:exer:SIRV:padapt',
               u'sec:de:exer:SIRV:padapt'),
              (u' Exercise 51: Refactor a flat program ',
               2,
               u'sec:de:exer:vib:FE:func',
               u'sec:de:exer:vib:FE:func'),
              (u' Exercise 52: Simulate oscillations by a general ODE solver ',
               2,
               u'sec:de:exer:vib:ode_FE',
               u'sec:de:exer:vib:ode_FE'),
              (u' Exercise 53: Compute the energy in oscillations ',
               2,
               u'sec:de:exer:vib:BE',
               u'sec:de:exer:vib:BE'),
              (u' Exercise 54: Use a Backward Euler scheme for population growth ',
               2,
               u'sec:de:exer:pg:BE',
               u'sec:de:exer:pg:BE'),
              (u' Exercise 55: Use a Crank-Nicolson scheme for population growth ',
               2,
               u'sec:de:exer:pg:CN',
               u'sec:de:exer:pg:CN'),
              (u' Exercise 56: Understand finite differences via Taylor series ',
               2,
               u'sec:de:exer:fd:Taylor',
               u'sec:de:exer:fd:Taylor'),
              (u' Exercise 57: Use a Backward Euler scheme for oscillations ',
               2,
               u'sec:de:exer:vib:BE',
               u'sec:de:exer:vib:BE'),
              (u' Remarks ', 3, None, '___sec190'),
              (u" Exercise 58: Use Heun's method for the SIR model ",
               2,
               u'sec:de:exer:SIR:Heun',
               u'sec:de:exer:SIR:Heun'),
              (u' Exercise 59: Use Odespy to solve a simple ODE ',
               2,
               u'sec:de:exer:odespy:decay',
               u'sec:de:exer:odespy:decay'),
              (u' Exercise 60: Set up a Backward Euler scheme for oscillations ',
               2,
               u'sec:de:exer:osc:BE',
               u'sec:de:exer:osc:BE'),
              (u' Exercise 61: Set up a Forward Euler scheme for nonlinear and damped oscillations ',
               2,
               u'sec:de:exer:osc:FE:general',
               u'sec:de:exer:osc:FE:general'),
              (u' Exercise 62: Discretize an initial condition ',
               2,
               u'sec:de:exer:osc:2nd:V0ic',
               u'sec:de:exer:osc:2nd:V0ic'),
              (u' Solving partial differential equations ',
               0,
               u'6th:SolvPDEs',
               u'6th:SolvPDEs'),
              (u' Finite difference methods ',
               1,
               u'6th:SolvPDEs:MOLandFE',
               u'6th:SolvPDEs:MOLandFE'),
              (u' Reduction of a PDE to a system of ODEs ',
               2,
               u'sec:pde:diff1D:reduce',
               u'sec:pde:diff1D:reduce'),
              (u' Construction of a test problem with known discrete solution ',
               2,
               u'sec:pde:diff1D:testproblem',
               u'sec:pde:diff1D:testproblem'),
              (u' Implementation: Forward Euler method ',
               2,
               None,
               '___sec200'),
              (u' Application: heat conduction in a rod ',
               2,
               u'sec:pde:diff1D:rod',
               u'sec:pde:diff1D:rod'),
              (u' Vectorization ', 2, None, '___sec202'),
              (u' Using Odespy to solve the system of ODEs ',
               2,
               None,
               '___sec203'),
              (u' Implicit methods ', 2, None, '___sec204'),
              (u' Exercises ', 1, None, '___sec205'),
              (u' Exercise 63: Simulate a diffusion equation by hand ',
               2,
               u'sec:pde:diff1D:exer:handFE',
               u'sec:pde:diff1D:exer:handFE'),
              (u' Exercise 64: Compute temperature variations in the ground ',
               2,
               u'sec:pde:diff1D:exer:groundtemp',
               u'sec:pde:diff1D:exer:groundtemp'),
              (u' Exercise 65: Compare implicit methods ',
               2,
               u'sec:pde:diff1D:exer:compare:implicit',
               u'sec:pde:diff1D:exer:compare:implicit'),
              (u' Exercise 66: Explore adaptive and implicit methods ',
               2,
               u'sec:pde:diff1D:exer:groundtemp:adapt',
               u'sec:pde:diff1D:exer:groundtemp:adapt'),
              (u' Exercise 67: Investigate the $\\theta$ rule ',
               2,
               u'sec:pde:diff1D:exer:CN',
               u'sec:pde:diff1D:exer:CN'),
              (u' Remarks ', 3, None, '___sec211'),
              (u' Exercise 68: Compute the diffusion of a Gaussian peak ',
               2,
               u'sec:pde:diff1D:exer:Gaussian',
               u'sec:pde:diff1D:exer:Gaussian'),
              (u' Exercise 69: Vectorize a function for computing the area of a polygon ',
               2,
               u'2nd:exer:area:polygon2',
               u'2nd:exer:area:polygon2'),
              (u' Exercise 70: Explore symmetry ',
               2,
               u'sec:pde:diff1D:exer:Gaussian:symm',
               u'sec:pde:diff1D:exer:Gaussian:symm'),
              (u' Remarks ', 3, None, '___sec215'),
              (u' Exercise 71: Compute solutions as $t\\rightarrow\\infty$ ',
               2,
               u'sec:pde:diff1D:exer:stationary',
               u'sec:pde:diff1D:exer:stationary'),
              (u' Remarks ', 3, None, '___sec217'),
              (u' Exercise 72: Solve a two-point boundary value problem ',
               2,
               u'sec:pde:diff1D:exer:stationary2',
               u'sec:pde:diff1D:exer:stationary2'),
              (u' Solving nonlinear algebraic equations ',
               0,
               u'4th:NonlinAlgEq',
               u'4th:NonlinAlgEq'),
              (u' Brute force methods ',
               1,
               u'4th:bruteforce',
               u'4th:bruteforce'),
              (u' Brute force root finding ', 2, None, '___sec221'),
              (u' Numerical algorithm ', 3, None, '___sec222'),
              (u' Implementation ', 3, None, '___sec223'),
              (u' Brute force optimization ', 2, None, '___sec224'),
              (u' Numerical algorithm ', 3, None, '___sec225'),
              (u' Implementation ', 3, None, '___sec226'),
              (u' Model problem for algebraic equations ',
               2,
               None,
               '___sec227'),
              (u" Newton's method ",
               1,
               u'4th:NonlinAlgEq:Newt',
               u'4th:NonlinAlgEq:Newt'),
              (u" Deriving and implementing Newton's method ",
               2,
               None,
               '___sec229'),
              (u' Making a more efficient and robust implementation ',
               2,
               u'4th:Newton:robust',
               u'4th:Newton:robust'),
              (u' The secant method ',
               1,
               u'4th:NonlinAlgEq:Secant',
               u'4th:NonlinAlgEq:Secant'),
              (u' The bisection method ',
               1,
               u'4th:NonlinAlgEq:Bisect',
               u'4th:NonlinAlgEq:Bisect'),
              (u' Rate of convergence ',
               1,
               u'4th:NonlinAlgEq:RateConv',
               u'4th:NonlinAlgEq:RateConv'),
              (u' Exercises ', 1, None, '___sec234'),
              (u" Exercise 73: Understand why Newton's method can fail ",
               2,
               u'4th:exer:Newton:failure',
               u'4th:exer:Newton:failure'),
              (u' Exercise 74: See if the secant method fails ',
               2,
               u'4th:exer:Secant:failure',
               u'4th:exer:Secant:failure'),
              (u' Exercise 75: Understand how the bisection method cannot fail ',
               2,
               u'4th:exer:Bisection:failure',
               u'4th:exer:Bisection:failure'),
              (u" Exercise 76: Combine the bisection method with Newton's method ",
               2,
               u'4th:exer:Bisection:Newton',
               u'4th:exer:Bisection:Newton'),
              (u" Exercise 77: Write a test function for Newton's method ",
               2,
               u'4th:exer:NewtonHand',
               u'4th:exer:NewtonHand'),
              (u' Exercise 78: Solve nonlinear equation for a vibrating beam ',
               2,
               u'4th:exer:beam:vib',
               u'4th:exer:beam:vib'),
              (u' Appendix: Getting access to Python ',
               0,
               u'app:accesspy',
               u'app:accesspy'),
              (u' Required software ',
               1,
               u'sec:accesspy:softwarelist',
               u'sec:accesspy:softwarelist'),
              (u' Installing software on your laptop: Mac OS X and Windows ',
               1,
               u'sec:accesspy:MacWin',
               u'sec:accesspy:MacWin'),
              (u' Anaconda and Spyder ',
               1,
               u'sec:accesspy:anaconda',
               u'sec:accesspy:anaconda'),
              (u' Spyder on Mac ', 2, None, '___sec245'),
              (u' Installation of additional packages ',
               2,
               None,
               '___sec246'),
              (u' Installing SciTools on Mac ', 2, None, '___sec247'),
              (u' Installing SciTools on Windows ', 2, None, '___sec248'),
              (u' VMWare Fusion virtual machine ',
               1,
               u'sec:accesspy:vmware',
               u'sec:accesspy:vmware'),
              (u' Installing Ubuntu ',
               2,
               u'sec:accesspy:vmware:fullblown:machine',
               u'sec:accesspy:vmware:fullblown:machine'),
              (u' Installing software on Ubuntu ', 2, None, '___sec251'),
              (u' File sharing ', 2, None, '___sec252'),
              (u' Dual boot on Windows ', 1, None, '___sec253'),
              (u' Vagrant virtual machine ',
               1,
               u'sec:accesspy:vagrant',
               u'sec:accesspy:vagrant'),
              (u' How to write and run a Python program ',
               1,
               u'sec:accesspy:writerun',
               u'sec:accesspy:writerun'),
              (u' The need for a text editor ', 2, None, '___sec256'),
              (u' Spyder ', 2, None, '___sec257'),
              (u' Text editors ', 2, None, '___sec258'),
              (u' Terminal windows ', 2, None, '___sec259'),
              (u' Using a plain text editor and a terminal window ',
               2,
               None,
               '___sec260'),
              (u' The SageMathCloud and Wakari web services ',
               1,
               u'sec:accesspy:sagemath:wakari',
               u'sec:accesspy:sagemath:wakari'),
              (u' Basic intro to SageMathCloud ', 2, None, '___sec262'),
              (u' Basic intro to Wakari ', 2, None, '___sec263'),
              (u' Installing your own Python packages ',
               2,
               None,
               '___sec264'),
              (u' Writing IPython notebooks ',
               1,
               u'sec:accesspy:ipynb',
               u'sec:accesspy:ipynb'),
              (u' A simple program in the notebook ', 2, None, '___sec266'),
              (u' Mixing text, mathematics, code, and graphics ',
               2,
               None,
               '___sec267'),
              (u' References ', 0, None, '___sec268')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands.tex -->
$$
\newcommand{\Oof}[1]{\mathcal{O}(#1)}
$$




    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="p4c-bootstrap-Python.html">Programming for Computations - A Gentle Introduction to Numerical Simulations with Python</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python000.html#___sec0" style="font-size: 80%;">Preface</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python001.html#1st:TheFirstFewSteps" style="font-size: 80%;">The first few steps</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python007.html#2nd:BasicConstructins" style="font-size: 80%;">Basic constructions</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python013.html#sec:integrals" style="font-size: 80%;">Computing integrals</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python017.html#5th:SolvODEs" style="font-size: 80%;">Solving ordinary differential equations</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python022.html#6th:SolvPDEs" style="font-size: 80%;">Solving partial differential equations</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python024.html#4th:NonlinAlgEq" style="font-size: 80%;">Solving nonlinear algebraic equations</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python030.html#app:accesspy" style="font-size: 80%;">Appendix: Getting access to Python</a></li>
     <!-- navigation toc: --> <li><a href="._p4c-bootstrap-Python039.html#___sec268" style="font-size: 80%;">References</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0014"></a>
<!-- !split -->

<h1 id="sec:integrals:trap">The composite trapezoidal rule</h1>

<p>
The integral \( \int_a^b f(x)dx \) may be interpreted as the
area between the \( x \) axis and the graph \( y=f(x) \) of the integrand.
Figure <a href="#fig:vCar">7</a> illustrates this area for the choice
<a href="._p4c-bootstrap-Python013.html#mjx-eqn-7">(7)</a>. Computing the integral \( \int_0^1f(t)dt \)
amounts to computing the area of the hatched region.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 7:  The integral of \( v(t) \) interpreted as the area under the graph of \( v \). <div id="fig:vCar"></div> </p></center>
<p><img src="figs/integral_of_f.png" align="bottom" width=400></p>
</center>

<p>
If we <em>replace</em> the true graph in Figure <a href="#fig:vCar">7</a> by a set of
straight line segments, we may view the area rather as composed of
trapezoids, the areas of which are easy to compute. This is
illustrated in Figure <a href="#fig:vCarTrapeze">8</a>, where 4 straight line
segments give rise to 4 trapezoids, covering the time intervals
\( [0,0.2) \), \( [0.2,0.6) \), \( [0.6,0.8) \) and \( [0.8,1.0] \). Note that
these intervals are <em>not</em> of the same size (although we very often we work
with equal-sized trapezoids for simplicity).

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 8:  Computing approximately the integral of a function as the sum of the areas of the trapezoids. <div id="fig:vCarTrapeze"></div> </p></center>
<p><img src="figs/viz_trapezoidal.png" align="bottom" width=400></p>
</center>

<p>
The areas of the 4 trapezoids shown in Figure <a href="#fig:vCarTrapeze">8</a>
now constitute our approximation to the integral
<a href="._p4c-bootstrap-Python013.html#mjx-eqn-7">(7)</a>:

$$
\begin{align}
\int_0^1 v(t)dt &\approx
h_1 (\frac{v(0)+v(0.2)}{2}) + h_2 (\frac{v(0.2)+v(0.6)}{2}) \nonumber  \\ 
&+ h_3 (\frac{v(0.6)+v(0.8)}{2}) + h_4 (\frac{v(0.8)+v(1.0)}{2}),
\tag{9}
\end{align}
$$

where

$$
\begin{align}
h_1 &= (0.2 - 0.0),
\tag{10}  \\ 
h_2 &= (0.6 - 0.2),
\tag{11}  \\ 
h_3 &= (0.8 - 0.6),
\tag{12}  \\ 
h_4 &= (1.0 - 0.8)\thinspace
\tag{13}
\end{align}
$$

With \( v(t) = 3t^{2}e^{t^3} \), each term in <a href="#mjx-eqn-9">(9)</a> is readily computed and our approximate computation gives
$$
\begin{equation}
\int_0^1 v(t)dt \approx 1.895\thinspace .
\tag{14}
\end{equation}
$$

Compared to the true answer of \( 1.718 \), this is off by about
10%. However, note that we used just 4 trapezoids to approximate the
area. With more trapezoids, the approximation would have become
better, since the straight line segments in the upper trapezoid side
then would follow the graph more closely. Doing another hand
calculation with more trapezoids is not too tempting for a lazy human,
though, but it is a perfect job for a computer! Let us therefore
derive the expressions for approximating the integral
by an arbitrary number of trapezoids.

<h2 id="sec:integrals:formula">The general formula</h2>

<p>
For a given function \( f(x) \), we want to approximate the
integral \( \int_a^bf(x)dx \) by \( n \) trapezoids. We start out with
<a href="._p4c-bootstrap-Python013.html#mjx-eqn-5">(5)</a> and approximate each integral on the right hand side
with a single trapezoid. In detail,

$$
\begin{align}
\int_a^b f(x)\,dx &= \int_{x_0}^{x_1} f(x) dx + \int_{x_1}^{x_2} f(x) dx + \ldots + \int_{x_{n-1}}^{x_n} f(x) dx,     \nonumber \\ 
                  &\approx h \frac{f(x_0) + f(x_1)}{2} + h \frac{f(x_1) + f(x_2)}{2} + \ldots + h \frac{f(x_{n-1}) + f(x_n)}{2} \tag{15}
\end{align}
$$

By simplifying the right hand side of <a href="#mjx-eqn-15">(15)</a> we get

$$
\begin{equation}
\int_a^b f(x)\,dx \approx \\ 
\frac{h}{2}\left[f(x_0) + 2 f(x_1) + 2 f(x_2) + \ldots + 2 f(x_{n-1}) + f(x_n)\right]              \tag{16}
\end{equation}
$$

which is more compactly written as

$$
\begin{equation}
\int_a^b f(x)\,dx \approx h \left[\frac{1}{2}f(x_0) + \sum_{i=1}^{n-1}f(x_i) + \frac{1}{2}f(x_n) \right] \thinspace .
\tag{17}
\end{equation}
$$

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Composite integration rules.</b>
The word <em>composite</em> is often used when a numerical integration method
is applied with more than one sub-interval. Strictly speaking then,
writing, e.g., &quot;the trapezoidal method&quot;, should imply the use of
only a single trapezoid, while &quot;the composite trapezoidal method&quot; is
the most correct name when several trapezoids are used.  However, this
naming convention is not always followed, so saying just &quot;the
trapezoidal method&quot; may point to a single trapezoid as well as the
composite rule with many trapezoids.
</div>


<h2 id="sec:integrals:trap:impl">Implementation</h2>

<h3 id="___sec78">Specific or general implementation? </h3>

<p>
Suppose our primary goal was to compute the specific integral
\( \int_0^1 v(t)dt \) with \( v(t)=3t^2e^{t^3} \). First we played around with
a simple hand calculation to see what the method was about, before we
(as one often does in mathematics) developed a general formula
<a href="#mjx-eqn-17">(17)</a> for the general or &quot;abstract&quot; integral
\( \int_a^bf(x)dx \).  To solve our specific problem \( \int_0^1 v(t)dt \) we
must then apply the general formula <a href="#mjx-eqn-17">(17)</a> to the given data
(function and integral limits) in our problem.  Although simple in
principle, the practical steps are confusing for many because the
notation in the abstract problem in <a href="#mjx-eqn-17">(17)</a> differs from the
notation in our special problem.  Clearly, the \( f \), \( x \), and \( h \) in
<a href="#mjx-eqn-17">(17)</a> correspond to \( v \), \( t \), and perhaps \( \Delta t \) for the
trapezoid width in our special problem.

<p>
<div class="alert alert-block alert-info alert-text-normal"><b>The programmer's dilemma.</b>

<ol>
<li> Should we write a special program for the special integral,
   using the ideas from the general rule <a href="#mjx-eqn-17">(17)</a>, but
   replacing \( f \) by \( v \), \( x \) by \( t \), and \( h \) by \( \Delta t \)?</li>
<li> Should we implement the general method <a href="#mjx-eqn-17">(17)</a> as it stands in a
   general function <code>trapezoid(f, a, b, n)</code> and solve the specific
   problem at hand by a specialized call to this function?</li>
</ol>

<b>Alternative 2 is always the best choice!</b>
</div>


<p>
The first alternative in the box above sounds less abstract and
therefore more attractive to many. Nevertheless, as we hope will be
evident from the examples, the second alternative is actually the
simplest <em>and</em> most reliable from both a mathematical and programming
point of view. These authors will claim that the second alternative
is the essence of the power of mathematics, while the first alternative
is the source of much confusion about mathematics!

<h3 id="___sec79">Implementation with functions </h3>

<p>
For the integral \( \int_a^bf(x)dx \) computed by the formula
<a href="#mjx-eqn-17">(17)</a> we want the corresponding Python function <code>trapezoid</code>
to take any \( f \), \( a \), \( b \), and \( n \) as input and return the
approximation to the integral.

<p>
We write a Python function <code>trapezoidal</code>
in a file <a href="https://github.com/hplgit/prog4comp/src/py/trapezoidal.py" target="_self"><tt>trapezoidal.py</tt></a>
as close as possible
to the formula <a href="#mjx-eqn-17">(17)</a>, making sure variable names correspond
to the mathematical notation:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">trapezoidal</span>(f, a, b, n):
    h <span style="color: #666666">=</span> <span style="color: #008000">float</span>(b<span style="color: #666666">-</span>a)<span style="color: #666666">/</span>n
    result <span style="color: #666666">=</span> <span style="color: #666666">0.5*</span>f(a) <span style="color: #666666">+</span> <span style="color: #666666">0.5*</span>f(b)
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, n):
        result <span style="color: #666666">+=</span> f(a <span style="color: #666666">+</span> i<span style="color: #666666">*</span>h)
    result <span style="color: #666666">*=</span> h
    <span style="color: #008000; font-weight: bold">return</span> result
</pre></div>

<h3 id="___sec80">Solving our specific problem in a session </h3>

<p>
Just having the <code>trapezoidal</code> function as the only content
of a file <code>trapezoidal.py</code> automatically
makes that file to a module that we can import and test in an
interactive session:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">trapezoidal</span> <span style="color: #008000; font-weight: bold">import</span> trapezoidal
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> exp
<span style="color: #666666">&gt;&gt;&gt;</span> v <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> t: <span style="color: #666666">3*</span>(t<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>exp(t<span style="color: #666666">**3</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> n <span style="color: #666666">=</span> <span style="color: #666666">4</span>
<span style="color: #666666">&gt;&gt;&gt;</span> numerical <span style="color: #666666">=</span> trapezoidal(v, <span style="color: #666666">0</span>, <span style="color: #666666">1</span>, n)
<span style="color: #666666">&gt;&gt;&gt;</span> numerical
<span style="color: #666666">1.9227167504675762</span>
</pre></div>
<p>
Let us compute the exact expression and the error in the approximation:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> V <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> t: exp(t<span style="color: #666666">**3</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> exact <span style="color: #666666">=</span> V(<span style="color: #666666">1</span>) <span style="color: #666666">-</span> V(<span style="color: #666666">0</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> exact <span style="color: #666666">-</span> numerical
<span style="color: #666666">-0.20443492200853108</span>
</pre></div>
<p>
Is this error convincing? We can try a larger \( n \):

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> numerical <span style="color: #666666">=</span> trapezoidal(v, <span style="color: #666666">0</span>, <span style="color: #666666">1</span>, n<span style="color: #666666">=400</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> exact <span style="color: #666666">-</span> numerical
<span style="color: #666666">-2.1236490512777095e-05</span>
</pre></div>
<p>
Fortunately, many more trapezoids give a much smaller error.

<h3 id="___sec81">Solving our specific problem in a program </h3>

<p>
Instead of computing our special problem in an interactive session,
we can do it in a program. As always, a chunk of code doing a
particular thing is best isolated as a function even if we do
not see any future reason to call the function several times and
even if we have no need for arguments to parameterize what goes
on inside the function. In the present case, we just put the
statements we otherwise would have put in a main program, inside
a function:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">application</span>():
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> exp
    v <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> t: <span style="color: #666666">3*</span>(t<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>exp(t<span style="color: #666666">**3</span>)
    n <span style="color: #666666">=</span> <span style="color: #008000">input</span>(<span style="color: #BA2121">&#39;n: &#39;</span>)
    numerical <span style="color: #666666">=</span> trapezoidal(v, <span style="color: #666666">0</span>, <span style="color: #666666">1</span>, n)

    <span style="color: #408080; font-style: italic"># Compare with exact result</span>
    V <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> t: exp(t<span style="color: #666666">**3</span>)
    exact <span style="color: #666666">=</span> V(<span style="color: #666666">1</span>) <span style="color: #666666">-</span> V(<span style="color: #666666">0</span>)
    error <span style="color: #666666">=</span> exact <span style="color: #666666">-</span> numerical
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;n=</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">: </span><span style="color: #BB6688; font-weight: bold">%.16f</span><span style="color: #BA2121">, error: </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (n, numerical, error)
</pre></div>
<p>
Now we compute our special problem by calling <code>application()</code> as
the only statement in the main program.
Both the <code>trapezoidal</code> and <code>application</code> functions reside in the
file <code>trapezoidal.py</code>, which can be run as

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python trapezoidal.py
n: 4
n=4: 1.9227167504675762, error: -0.204435
</pre></div>

<h2 id="___sec82">Making a module </h2>

<p>
When we have the different pieces of our program as a collection of
functions, it is very straightforward to create a <em>module</em> that can be
imported in other programs. That is, having our code as a module,
means that the <code>trapezoidal</code> function can easily be reused by other
programs to solve other problems.  The requirements of a module are
simple: put everything inside functions and let function calls in the
main program be in the so-called <em>test block</em>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    application()
</pre></div>
<p>
The <code>if</code> test is true if the module file, <code>trapezoidal.py</code>, is run
as a program and false if the module is imported in another program.
Consequently, when we do an import <code>from trapezoidal import trapezoidal</code>
in some file, the test fails and <code>application()</code> is not called, i.e.,
our special problem is not solved and will not print anything on
the screen. On the other hand, if we run <code>trapezoidal.py</code> in the
terminal window, the test condition is positive, <code>application()</code>
is called, and we get output in the window:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python trapezoidal.py
n: 400
n=400: 1.7183030649495579, error: -2.12365e-05
</pre></div>

<h2 id="___sec83">Alternative flat special-purpose implementation </h2>

<p>
Let us illustrate the implementation implied by alternative 1
in the <em>Programmer's dilemma</em> box in the section <a href="#sec:integrals:trap:impl">Implementation</a>.
That is, we make a special-purpose code where we adapt the
general formula <a href="#mjx-eqn-17">(17)</a>
to the specific problem \( \int_0^1 3t^2e^{t^3}dt \).

<p>
Basically, we use a <code>for</code> loop to compute the sum. Each term with \( f(x) \) in
the formula <a href="#mjx-eqn-17">(17)</a> is replaced by \( 3t^2e^{t^3} \), \( x \) by \( t \),
and \( h \) by \( \Delta t \) <button type="button" class="btn btn-primary btn-xs" rel="tooltip" data-placement="top" title="Replacing \( h \) by \( \Delta t \) is not strictly required as many use \( h \) as interval also along the time axis. Nevertheless, \( \Delta t \) is an even more popular notation for a small time interval, so we adopt that common notation."><a href="#def_footnote_1" id="link_footnote_1" style="color: white">1</a></button>. A first try at writing a plain,
flat program doing the special calculation is

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> exp

a <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>;  b <span style="color: #666666">=</span> <span style="color: #666666">1.0</span>
n <span style="color: #666666">=</span> <span style="color: #008000">input</span>(<span style="color: #BA2121">&#39;n: &#39;</span>)
dt <span style="color: #666666">=</span> <span style="color: #008000">float</span>(b <span style="color: #666666">-</span> a)<span style="color: #666666">/</span>n

<span style="color: #408080; font-style: italic"># Integral by the trapezoidal method</span>
numerical <span style="color: #666666">=</span> <span style="color: #666666">0.5*3*</span>(a<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>exp(a<span style="color: #666666">**3</span>) <span style="color: #666666">+</span> <span style="color: #666666">0.5*3*</span>(b<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>exp(b<span style="color: #666666">**3</span>)
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, n):
    numerical <span style="color: #666666">+=</span> <span style="color: #666666">3*</span>((a <span style="color: #666666">+</span> i<span style="color: #666666">*</span>dt)<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>exp((a <span style="color: #666666">+</span> i<span style="color: #666666">*</span>dt)<span style="color: #666666">**3</span>)
numerical <span style="color: #666666">*=</span> dt

exact_value <span style="color: #666666">=</span> exp(<span style="color: #666666">1**3</span>) <span style="color: #666666">-</span> exp(<span style="color: #666666">0**3</span>)
error <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(exact_value <span style="color: #666666">-</span> numerical)
rel_error <span style="color: #666666">=</span> (error<span style="color: #666666">/</span>exact_value)<span style="color: #666666">*100</span>
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;n=</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">: </span><span style="color: #BB6688; font-weight: bold">%.16f</span><span style="color: #BA2121">, error: </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (n, numerical, error)
</pre></div>
<p id="def_footnote_1"><a href="#link_footnote_1"><b>1:</b></a> Replacing \( h \) by \( \Delta t \) is not strictly
required as many use \( h \) as interval also along the time axis.
Nevertheless, \( \Delta t \) is an even more popular notation for
a small time interval, so we adopt that common notation.</p>

<p>
The problem with the above code is at least three-fold:

<ol>
<li> We need to reformulate <a href="#mjx-eqn-17">(17)</a> for our special
   problem with a different notation.</li>
<li> The integrand \( 3t^2e^{t^3} \) is inserted many times in the
   code, which quickly leads to errors.</li>
<li> A lot of edits are necessary to use the code to compute a different
   integral - these edits are likely to introduce errors.</li>
</ol>

The potential errors involved in point 2 serve to illustrate how important it is to use Python functions as mathematical functions. Here we have chosen to use the lambda function to define the integrand as the variable <code>v</code>:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> exp

v <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> t: <span style="color: #666666">3*</span>(t<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>exp(t<span style="color: #666666">**3</span>)  <span style="color: #408080; font-style: italic"># Function to be integrated</span>
a <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>;  b <span style="color: #666666">=</span> <span style="color: #666666">1.0</span>
n <span style="color: #666666">=</span> <span style="color: #008000">input</span>(<span style="color: #BA2121">&#39;n: &#39;</span>)
dt <span style="color: #666666">=</span> <span style="color: #008000">float</span>(b <span style="color: #666666">-</span> a)<span style="color: #666666">/</span>n

<span style="color: #408080; font-style: italic"># Integral by the trapezoidal method</span>
numerical <span style="color: #666666">=</span> <span style="color: #666666">0.5*</span>v(a) <span style="color: #666666">+</span> <span style="color: #666666">0.5*</span>v(b)
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, n):
    numerical <span style="color: #666666">+=</span> v(a <span style="color: #666666">+</span> i<span style="color: #666666">*</span>dt)
numerical <span style="color: #666666">*=</span> dt

F <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> t: exp(t<span style="color: #666666">**3</span>)
exact_value <span style="color: #666666">=</span> F(b) <span style="color: #666666">-</span> F(a)
error <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(exact_value <span style="color: #666666">-</span> numerical)
rel_error <span style="color: #666666">=</span> (error<span style="color: #666666">/</span>exact_value)<span style="color: #666666">*100</span>
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;n=</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">: </span><span style="color: #BB6688; font-weight: bold">%.16f</span><span style="color: #BA2121">, error: </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (n, numerical, error)
</pre></div>
<p>
Unfortunately, the two other problems remain and they are fundamental.

<p>
Suppose you want to compute another integral, say \( \int_{-1}^{1.1}e^{-x^2}dx \).
How much do we need to change in the previous code
to compute the new integral? Not so much:

<ul>
 <li> the formula for <code>v</code> must be replaced by a new formula</li>
 <li> the limits <code>a</code> and <code>b</code></li>
 <li> the anti-derivative \( V \) is not easily known <button type="button" class="btn btn-primary btn-xs" rel="tooltip" data-placement="top" title="You cannot integrate \( e^{-x^2} \) by hand, but this particular integral is appearing so often in so many contexts that the integral is a special function, called the Error function and written \( \mbox{erf}(x) \). In a code, you can call erf(x). The erf function is found in the math module."><a href="#def_footnote_2" id="link_footnote_2" style="color: white">2</a></button> and can be omitted,
   and therefore we cannot write out the error</li>
 <li> the notation should be changed to be aligned with the new problem, i.e.,
   <code>t</code> and <code>dt</code> changed to <code>x</code> and <code>h</code></li>
</ul>

<p id="def_footnote_2"><a href="#link_footnote_2"><b>2:</b></a> You cannot integrate \( e^{-x^2} \) by hand, but this particular
integral is appearing so often in so many contexts that the integral
is a special function, called the <a href="http://en.wikipedia.org/wiki/Error_function" target="_self">Error function</a> and written \( \mbox{erf}(x) \). In a code, you can
call <code>erf(x)</code>.
The <code>erf</code> function is found in the <code>math</code> module.</p>

<p>
These changes are straightforward to implement, but <em>they are scattered
around in the program</em>, a fact that requires us to be very careful so
we do not introduce new programming errors while we modify the code.
It is also very easy to forget to make a required change.

<p>
With the previous code in <code>trapezoidal.py</code>, we can compute
the new integral \( \int_{-1}^{1.1}e^{-x^2}dx \) <em>without touching
the mathematical algorithm</em>. In an interactive session (or
in a program) we can just do

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">trapezoidal</span> <span style="color: #008000; font-weight: bold">import</span> trapezoidal
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> exp
<span style="color: #666666">&gt;&gt;&gt;</span> trapezoidal(<span style="color: #008000; font-weight: bold">lambda</span> x: exp(<span style="color: #666666">-</span>x<span style="color: #666666">**2</span>), <span style="color: #666666">-1</span>, <span style="color: #666666">1.1</span>, <span style="color: #666666">400</span>)
<span style="color: #666666">1.5268823686123285</span>
</pre></div>
<p>
When you now look back at the two solutions, the flat special-purpose
program and the function-based program with the general-purpose
function <code>trapezoidal</code>, you hopefully realize that <em>implementing
a general mathematical algorithm in a general function</em> requires
somewhat more abstract thinking, but the resulting code can be
used over and over again. Essentially, if you apply the flat
special-purpose style, you have to retest the implementation of
the algorithm after every change of the program.

<p>
The present integral problems result in short code.
In more challenging engineering problems the code quickly grows
to hundreds and thousands of line. Without abstractions in terms
of general algorithms in general reusable functions, the complexity
of the program grows so fast that if will be extremely difficult
to make sure that the entire program works properly.

<p>
Another advantage of packaging mathematical algorithms in functions is
that function can be reused by anyone to solve a problem by just
calling the function with a proper set of arguments.  Understanding
the function's inner details is not necessary to compute a new
integral. Similarly, you can find libraries of functions on the
Internet and use these functions to solve your problems without
specific knowledge of every mathematical detail in the functions.
This desirable feature has its downside, of course: the user of a
function may misuse it, and the function may contain programming
errors and lead to wrong answers. Testing the output of downloaded
functions is therefore extremely important before relying on the
results.

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._p4c-bootstrap-Python013.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._p4c-bootstrap-Python015.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

